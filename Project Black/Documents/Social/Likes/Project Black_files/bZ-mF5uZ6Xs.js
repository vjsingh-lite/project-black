/*1302555909,169775813*/

if (window.CavalryLogger) { CavalryLogger.start_js(["+RUzj"]); }

function BuddyListDataSource(a){this.parent.construct(this,copy_properties(a,{maxResults:a.maxResults||Infinity,persistOnRefresh:a.persistOnRefresh||true}));}BuddyListDataSource.extend('DataSource');BuddyListDataSource.prototype={init:function(){this.parent.init();var a=Arbiter.subscribe(['buddylist/initialized','buddylist/availability-changed'],this._availableListChanged.shield(this));if(!this.persistOnRefresh)onleaveRegister(function(){Arbiter.unsubscribe(a);});},_availableListChanged:function(){var b=this.value,a=this.flatValue;this.dirty();this.addEntries(AvailableList.getAvailableIDs().map(function(c){return {uid:c,text:ChatUserInfos[c].name,photo:ChatUserInfos[c].thumbSrc,type:AvailableList.isIdle(c)?'idle':'active'};}));if(b)this.respond(b,this.buildUids(a),true);},refreshData:function(){AvailableList.update();}};
add_properties('TypeaheadRenderers',{buddylist:function(b,d){var f=htmlize(b.text),e=b.photo,a='',c=[];if(e)c=['<img src="',e,'" alt="" />'];return ['<li class="clearfix ',b.type,'">',c.join(''),'<span class="text">'+f+'</span>','<i class="'+b.type+'">','</i>','</li>'];}});
function Rect(e,d,a,c,b){if(this===window){if(e instanceof Rect)return e;if(e instanceof Vector2)return new Rect(e.y,e.x,e.y,e.x,e.domain);return Rect.getElementBounds($(e));}copy_properties(this,{t:e,r:d,b:a,l:c,domain:b||'pure'});}copy_properties(Rect.prototype,{w:function(){return this.r-this.l;},h:function(){return this.b-this.t;},toString:function(){return '(('+this.l+', '+this.t+'), ('+this.r+', '+this.b+'))';},contains:function(b){b=Rect(b).convertTo(this.domain);var a=this;return (a.l<=b.l&&a.r>=b.r&&a.t<=b.t&&a.b>=b.b);},add:function(c,d){if(arguments.length==1){if(c.domain!='pure')c=c.convertTo(this.domain);return this.add(c.x,c.y);}var a=parseFloat(c);var b=parseFloat(d);return new Rect(this.t+b,this.r+a,this.b+b,this.l+a,this.domain);},sub:function(a,b){if(arguments.length==1){return this.add(a.mul(-1));}else return this.add(-a,-b);},boundWithin:function(a){var b=0,c=0;if(this.l<a.l){b=a.l-this.l;}else if(this.r>a.r)b=a.r-this.r;if(this.t<a.t){c=a.t-this.t;}else if(this.b>a.b)c=a.b-this.b;return this.add(b,c);},getPositionVector:function(){return new Vector2(this.l,this.t,this.domain);},getDimensionVector:function(){return new Vector2(this.w(),this.h(),'pure');},convertTo:function(a){if(this.domain==a)return this;if(a=='pure')return new Rect(this.t,this.r,this.b,this.l,'pure');if(this.domain=='pure')return new Rect(0,0,0,0);var b=new Vector2(this.l,this.t,this.domain).convertTo(a);return new Rect(b.y,b.x+this.w(),b.y+this.h(),b.x,a);}});copy_properties(Rect,{newFromVectors:function(b,a){return new Rect(b.y,b.x+a.x,b.y+a.y,b.x,b.domain);},getElementBounds:function(a){return Rect.newFromVectors(Vector2.getElementPosition(a),Vector2.getElementDimensions(a));},getViewportBounds:function(){return Rect.newFromVectors(Vector2.getScrollPosition(),Vector2.getViewportDimensions());}});
add_properties('TypeaheadBehaviors',{chatBuddyList:function(b){var a=b.getView().getElement();b.subscribe('focus',function(){b.getData().refreshData();});b.subscribe('respond',function(c,d){if(d.value&&!d.results.length){var e=$N('div',{className:'noResults'},_tx("Friend not found on chat."));DOM.setContent(a,e);}CSS.show(a);});b.subscribe('reset',function(){CSS.hide(a);});b.subscribe('select',function(c,d){Chat.openTab(d.selected.uid);});b.subscribe('highlight',function(c,e){if(e.index>=0){var h=b.getView().getItems()[e.index];if(h){var g=Rect(h);var d=h.offsetParent;var f=g.boundWithin(Rect(d)).getPositionVector();g.getPositionVector().sub(f).scrollElementBy(d);}}});}});
function Collection(e,d){if(!e.__collection__){var a=new Function();for(var c in e.prototype)a.prototype[c]=Collection._call.bind(null,c);e.__collection__=a;}var b=new e.__collection__();b._elements=d;return b;}Collection._call=function(b){var a=Array.prototype.slice.call(arguments,1);this._elements.each(function(c){c[b].apply(c,a);});return this;};
add_properties('TypeaheadBehaviors',{requireSelection:function(c){var a=c.getCore();var b=a.getElement().form;function d(){!a.getHiddenValue()&&a.reset();}a.subscribe('blur',d);b&&Event.listen(b,'submit',d);}});