/*1301899840,176833975*/

if (window.CavalryLogger) { CavalryLogger.start_js(["l\/cef"]); }

function ProfileBrowser(){}ProfileBrowser.mixin('Arbiter',{init:function(b,d,c,e,a){this.listView=b;this.target=d;this.selector=c;this.typeahead=e;this.hubs=a;this.subscribeListView();this.selector&&this.subscribeSelector();this.typeahead&&this.subscribeTypeahead();this.hubs&&this.subscribeHubs();},setSelectionLimit:function(a){this.selectionLimit=a;return this;},subscribeListView:function(){this.listView.subscribe('clickedCheckable',function(a,b){this.listView.toggleCheckableItem(b.item,CSS.hasClass(b.item,'selectedCheckable'));}.bind(this));},subscribeSelector:function(){var a=this.typeahead&&this.typeahead.getCore();this.selector.subscribe('changeTarget',function(b,c){if(a){CSS.conditionShow(this.typeahead.getElement(),c.showtypeahead);a.getValue()&&a.reset();c.showtypeahead&&a.getElement().focus();}this.target=$(c.target);c.isprimer&&this.listView.setLoadingState(true);this.listView.swapList(this.target);this.hubs&&CSS.conditionShow(this.hubs.getElement(),c.hubs);}.bind(this));this.selector.subscribe('changeHub',function(b,e){var c=this.hubs.getCore();var d=c.getElement();this.hubs.init(this.hubBehaviors);this.hubs.swapData(this.hubsData[e.value]);c.reset();Input.setPlaceholder(d,e.placeholder);d.focus();this.hubendpoint=URI(e.endpoint);}.bind(this));},subscribeTypeahead:function(){this.typeahead.subscribe('render',function(){var a=this.typeahead.getCore().getValue()?this.typeahead.getView().element:this.target;this.listView.swapList(a);}.bind(this));this.typeahead.subscribe('reset',function(){this.listView.swapList(this.target);}.bind(this));this.typeahead.subscribe('activity',function(a,b){CSS.conditionClass(this.typeahead.getElement(),'loading',b.activity);}.bind(this));},subscribeHubs:function(){this.hubs.subscribe('select',function(a,b){this.hubendpoint.addQueryData({pageid:b.selected.uid,pagetext:b.selected.text,offset:0,target:this.target.id});CSS.addClass(this.hubs.getElement(),'hubsLoading');new AsyncRequest(this.hubendpoint).setReadOnly(true).setMethod('POST').setRelativeTo(this.selector.getSelectedAnchor()).setHandler(function(){CSS.removeClass(this.hubs.getElement(),'hubsLoading');}.bind(this)).send();}.bind(this));},addHubData:function(a){this.hubsData=copy_properties(this.hubsData,a);},addHubBehaviors:function(a){this.hubBehaviors=a;},getSelectionLimit:function(){return this.selectionLimit;}});
function SwitchableProfileBrowser(){this.parent.construct(this);}SwitchableProfileBrowser.extend('ProfileBrowser');SwitchableProfileBrowser.prototype={NORMAL:'normal',LARGE:'large',initViewButtons:function(a,b){this.viewButtons=a;this.subscribeViewButtons();},subscribeSelector:function(){this.parent.subscribeSelector();this.selector.subscribe('changeTarget',function(a,b){this.viewButtons.setEnabled(!b.hubs);}.bind(this));},subscribeTypeahead:function(){this.typeahead.subscribe('render',function(){if(this.typeahead.getCore().getValue()){this.listView.swapList(this.typeahead.getView().element);this.viewButtons.setEnabled(false);}else{this.listView.swapList(this.target);this.viewButtons.setEnabled(true);}}.bind(this));this.typeahead.subscribe('reset',function(){this.listView.swapList(this.target);this.viewButtons.setEnabled(true);}.bind(this));this.typeahead.subscribe('activity',function(a,b){CSS.conditionClass(this.typeahead.getElement(),'loading',b.activity);}.bind(this));},subscribeViewButtons:function(){this.viewButtons.subscribe('swapView',function(a,d){var b=this.typeahead&&this.typeahead.getCore();b&&b.getValue()&&b.reset();var c=this.listView.getRoot();CSS.conditionClass(c,this.NORMAL,d.view==this.NORMAL);CSS.conditionClass(c,this.LARGE,d.view==this.LARGE);}.bind(this));}};
function ProfileBrowserListView(){}ProfileBrowserListView.mixin('Arbiter',{SCROLL_TRIGGER:800,init:function(b,a){this.root=b;this.activeList=a;Event.listen(b,'click',this.handleClick.bind(this));},handleClick:function(event){var a=Parent.byClass(event.getTarget(),'checkableListItem');if(a&&!CSS.hasClass(a,'disabledCheckable'))this.inform('clickedCheckable',{item:a});},listenForScroll:function(){this._scroll=Event.listen(this.activeList,'scroll',this.handleScroll.bind(this));},handleScroll:function(event){var a=event.getTarget();if(this.SCROLL_TRIGGER>a.scrollHeight-a.scrollTop)this.inform('scrollTrigger');},resetScroll:function(){this._scroll&&this._scroll.remove();this.listenForScroll();},toggleCheckableItem:function(c,b){var a=DOM.find(c,'input.checkbox');a.checked=!b;CSS.conditionClass(c,'selectedCheckable',!b);var d=c.nextSibling||c.previousSibling;d&&CSS.addClass(d,'sib')&&CSS.removeClass(d,'sib');},setLoadingState:function(a){CSS.conditionClass(this.root,'showListviewLoading',a);},swapList:function(a){CSS.hide(this.activeList);this.activeList=a;CSS.show(this.activeList);},getRoot:function(){return this.root;},getActiveList:function(){return this.activeList;}});
function ProfileBrowserSelector(){}ProfileBrowserSelector.mixin('Arbiter',{init:function(a){this.selector=a;Selector.listen(a,'select',this.handle.bind(this));},handle:function(c){var a=DOM.find(c.option,'a');var d=a.getAttribute('data-target');var b=a.getAttribute('data-selectendpoint');var e=Selector.getOptionValue(c.option);if(d)this.inform('changeTarget',{target:d,isprimer:a.getAttribute('rel')=='async',showtypeahead:a.getAttribute('data-typeahead'),hubs:!!b});if(b)this.inform('changeHub',{value:e,placeholder:a.getAttribute('data-placeholder'),endpoint:b});},getSelectedValue:function(){return Selector.getValue(this.selector);},getSelectedAnchor:function(){return DOM.find(Selector.getSelectedOptions(this.selector)[0],'a');},setSelectedValue:function(a){Selector.setSelected(this.selector,a,true);}});
function ProfileBrowserTypeaheadCore(a){this.parent.construct(this,a);}ProfileBrowserTypeaheadCore.extend('TypeaheadCore');ProfileBrowserTypeaheadCore.prototype={keepFocused:false,initToggle:bagofholding,select:bagofholding};
function ProfileBrowserTypeaheadView(a,b){this.parent.construct(this,a,b);}ProfileBrowserTypeaheadView.extend('TypeaheadView');ProfileBrowserTypeaheadView.prototype={buildSummaryBox:function(c,a){var b,d=_tx("\u003cstrong>{value}\u003c\/strong>",{value:htmlize(c)});if(!a||!a.length){b=_tx("No results for: {search}",{search:d});}else if(a.length==1){b=_tx("Top result for: {search}",{search:d});}else b=_tx("Top {count} results for: {search}",{count:a.length,search:d});return ('<div class="fbProfileBrowserSummaryBox phs pvm">'+b+'</div>');},render:function(b,a){this.results=a;this.element.innerHTML=this.buildSummaryBox(b,a)+this.buildMarkup(a);this.items=this.getItems();this.inform('render',a);},click:bagofholding,buildMarkup:function(a){return ('<div class="fbProfileBrowserListContainer">'+'<div class="fbProfileBrowserList">'+this.parent.buildMarkup(a)+'</div>'+'</div>');},renderer:function(a){return ['<li class="uiListItem uiListLight uiListVerticalItemBorder">','<div class="UIImageBlock clearfix UIImageBlock_Entity">','<a class="UIImageBlock_Image UIImageBlock_ENT_Image" ','tabindex="-1" href="',a.path,'">','<img class="img" src="',a.photo,'" />','</a>','<div class="UIImageBlock_Content UIImageBlock_ENT_Content">','<div class="fsl fwb fcb">','<a href="',a.path,'">',htmlize(a.text),'</a>','</div>','<div class="fsm fwn fcg">',a.category,'</div>','</div>','</div>','</li>'];}};
function ProfileBrowserViewButtons(){}ProfileBrowserViewButtons.mixin('Arbiter',{init:function(a,c,b){this.root=a;this.buttons=DOM.scry(this.root,'.profileBrowserViewButton');this.searchView=b;this.selected=c;this.enabled=true;Event.listen(a,'click',this.handle.bind(this));},handle:function(event){if(!this.enabled)return;var b=event.getTarget();var a=Parent.byClass(b,'profileBrowserViewButton');if(CSS.hasClass(a,'uiButtonDepressed'))return;CSS.removeClass(this.selected,'uiButtonDepressed');this.selected=a;CSS.addClass(this.selected,'uiButtonDepressed');this.inform('swapView',{view:Button.getInputElement(this.selected).name});},setEnabled:function(a){this.enabled=a;this.buttons.each(function(b){Button.setEnabled(b,a);});}});