/*1302902450,169776317*/

if (window.CavalryLogger) { CavalryLogger.start_js(["pfg5Z"]); }

if(!window.FB)window.FB={_apiKey:null,_session:null,_userStatus:'unknown',_logging:true,_inCanvas:((window.location.search.indexOf('fb_sig_in_iframe=1')>-1)||(window.location.search.indexOf('session=')>-1)||(window.location.search.indexOf('signed_request=')>-1)||(window.name.indexOf('iframe_canvas')>-1)||(window.name.indexOf('app_runner')>-1)),_https:(window.name.indexOf('_fb_https')>-1),_domain:{api:'https://api.facebook.com/',api_read:'https://api-read.facebook.com/',cdn:'http://static.ak.fbcdn.net/',https_cdn:'https://s-static.ak.fbcdn.net/',graph:'https://graph.facebook.com/',staticfb:'http://static.ak.facebook.com/',https_staticfb:'https://s-static.ak.facebook.com/',www:window.location.protocol+'//www.facebook.com/',https_www:'https://www.facebook.com/'},_locale:null,_localeIsRtl:false,getDomain:function(a){switch(a){case 'api':return FB._domain.api;case 'api_read':return FB._domain.api_read;case 'cdn':return (window.location.protocol=='https:'||FB._https)?FB._domain.https_cdn:FB._domain.cdn;case 'graph':return FB._domain.graph;case 'staticfb':return FB._https?FB._domain.https_staticfb:FB._domain.staticfb;case 'https_staticfb':return FB._domain.https_staticfb;case 'www':return FB._https?FB._domain.https_www:FB._domain.www;case 'https_www':return FB._domain.https_www;}},copy:function(d,c,b,e){for(var a in c)if(b||typeof d[a]==='undefined')d[a]=e?e(c[a]):c[a];return d;},create:function(c,h){var e=window.FB,d=c?c.split('.'):[],a=d.length;for(var b=0;b<a;b++){var g=d[b];var f=e[g];if(!f){f=(h&&b+1==a)?h:{};e[g]=f;}e=f;}return e;},provide:function(c,b,a){return FB.copy(typeof c=='string'?FB.create(c):c,b,a);},guid:function(){return 'f'+(Math.random()*(1<<30)).toString(16).replace('.','');},log:function(a){if(FB._logging)if(window.Debug&&window.Debug.writeln){window.Debug.writeln(a);}else if(window.console)window.console.log(a);if(FB.Event)FB.Event.fire('fb.log',a);},$:function(a){return document.getElementById(a);}};
FB.provide('Intl',{_punctCharClass:('['+'.!?'+'\u3002'+'\uFF01'+'\uFF1F'+'\u0964'+'\u2026'+'\u0EAF'+'\u1801'+'\u0E2F'+'\uFF0E'+']'),_endsInPunct:function(a){if(typeof a!='string')return false;return a.match(new RegExp(FB.Intl._punctCharClass+'['+')"'+"'"+'\u00BB'+'\u0F3B'+'\u0F3D'+'\u2019'+'\u201D'+'\u203A'+'\u3009'+'\u300B'+'\u300D'+'\u300F'+'\u3011'+'\u3015'+'\u3017'+'\u3019'+'\u301B'+'\u301E'+'\u301F'+'\uFD3F'+'\uFF07'+'\uFF09'+'\uFF3D'+'\s'+']*$'));},_tx:function(d,a){if(a!==undefined)if(typeof a!='object'){FB.log('The second arg to FB.Intl._tx() must be an Object for '+'tx('+d+', ...)');}else{var c;for(var b in a)if(a.hasOwnProperty(b)){if(FB.Intl._endsInPunct(a[b])){c=new RegExp('\{'+b+'\}'+FB.Intl._punctCharClass+'*','g');}else c=new RegExp('\{'+b+'\}','g');d=d.replace(c,a[b]);}}return d;},tx:function(b,a){function c(e,d){void(0);}if(!FB.Intl._stringTable)return null;return FBIntern.Intl._tx(FB.Intl._stringTable[b],a);}});
function ads_refresh(k,g,f,h,l,j){if(window.ads_refreshing)return;if(l===undefined)l=0;if(j===undefined)j=0;var i=['sidebar_ads','home_sponsor_nile','ego'];var e=[];for(var d=0;d<i.length;d++)if(ge(i[d])||(i[d]=='ego'&&DOM.scry($('content'),'div.ego_column').length>0))e.push(i[d]);if(e.length===0)return;var c={page:g,queryId:j,tab:k,timestamp:(+new Date()),locations:e,photo_refresh:(h?'yes':'no'),cache:l};if(e.indexOf('ego')>=0)c.page_url=URI.getRequestURI().toString();var b=function(r){window.ads_refreshing=false;var m=r.getPayload();for(var q in m){if(q=='ego'){var n=DOM.scry($('content'),'div.ego_column');if(n.length>0){DOM.replace(n[0],HTML(m[q]));for(var p=1;p<n.length;++p)DOM.empty(n[p]);}continue;}var o=ge(q);if(o&&m[q].length>0)if(ua.ie()<7){o.outerHTML=m[q];}else DOM.replace(o,HTML(m[q]));}if(f)f(r);};var a=function(m){window.ads_refreshing=false;};new AsyncRequest().setURI('/ajax/location_refresh.php').setData(c).setOption('bundle',true).setHandler(b).setErrorHandler(a).send();window.ads_refreshing=true;}
function AppUseTracker(){if(!AppUseTracker.instance)AppUseTracker.instance=this;return AppUseTracker.instance;}copy_properties(AppUseTracker.prototype,{instance:null,endpoint:'/ajax/apps/usage_update.php',INITIAL_PING:0,ONGOING_PING:1,DISCOVERY_PING:2,init:function(a,d,e,c,b){if(window!=window.top)return;this.cleanup();PageTransitions.registerHandler(this.catchPageTransition.bind(this));this._timers.push(setTimeout(function(){(new AsyncSignal(this.endpoint,{app:a,is_game:d,type:this.INITIAL_PING})).send();var f=new AsyncSignal(this.endpoint,{app:a,is_game:d,type:this.ONGOING_PING});this._timers.push(setInterval(f.send.bind(f),c));}.bind(this),e));if(b)this._timers.push(setTimeout(function(){(new AsyncSignal(this.endpoint,{app:a,is_game:d,type:this.DISCOVERY_PING})).send();}.bind(this),b));},catchPageTransition:function(a){this.cleanup();},cleanup:function(){if(this._timers)for(i=0;i<this._timers.length;i++)clearInterval(this._timers[i]);this._timers=[];}});
function ComposerAttachment(){this._container=null;}copy_properties(ComposerAttachment,{newFromURL:function(c,b){if(!/(?:https?:\/\/)?\w+\.\w+/.test(c))return false;var a=new ComposerAttachment();a.url=c;new AsyncRequest().setURI('/ajax/inbox/ajax.php').setData({action:'attachment',url:c}).setHandler(a._asyncCallback.bind(a)).setErrorHandler(b).send();return a;},setupThumbnails:function(a,b){var c=new ImageSandbox();c.onfinish=function(){a=c.getImages();for(var d=a.length-1;d>=0;d--)if(a[d].width&&(a[d].height<50||a[d].width<50||a[d].height/a[d].width>3||a[d].width/a[d].height>3))a.splice(d,1);if(!a.length){CSS.removeClass(b,'loading');CSS.removeClass(b.parentNode,'has_image');var e=b;while(e.parentNode&&e.tagName.toLowerCase()!='form')e=e.parentNode;e=e.getElementsByTagName('input');for(var d=0;d<e.length;d++)if(e[d].name.indexOf('[params][images]')!=-1)e[d].parentNode.removeChild(e[d]);return;}for(var f=0;f<a.length-1;f++)for(var g=a.length-1;g>=f;g--)if(a[f].width*a[f].height<a[g].width*a[g].height){temp=a[f];a[f]=a[g];a[g]=temp;}var e=b;while(e.parentNode&&e.tagName.toLowerCase()!='form')e=e.parentNode;e=e.getElementsByTagName('input');for(var d=0;d<e.length;d++)if(e[d].name.indexOf('[params][images]')!=-1){e=e[d];break;}CSS.removeClass(b,'loading');new ThumbnailSelector(b,e,a);}.bind(this);c.loadImages(a);}});copy_properties(ComposerAttachment.prototype,{containerReady:function(d,e){this._container=d;var c=d.getElementsByTagName('input');var a=[''];for(var b=0;b<c.length;b++)if(c[b].type=='text'||c[b].type=='hidden')a.push('<input type="hidden" name="'+htmlspecialchars(c[b].name)+'" value="'+htmlspecialchars(c[b].value)+'" />');if(e){a.push('&nbsp;');d.innerHTML=a.join('');CSS.addClass(d,'share_attachment_loading');}else d.innerHTML+=a.join('');},_renderInputsRecursive:function(c,d){if(d===null)return '';var a=[];if(typeof(d)=='object'){for(var b in d)a.push(this._renderInputsRecursive(c+'['+b+']',d[b]));}else if(typeof(d)!='function')a.push('<input type="hidden" name="',c,'" value="',htmlspecialchars(d),'" />');return a.join('');},_asyncCallback:function(b){var a=b.getPayload().html;CSS.removeClass(this._container,'share_attachment_loading');DOM.setContent(this._container,HTML(a));}});function ThumbnailSelector(f,d,c){var b=['<div class="thumbnail_stage"><h4>'+_tx("Choose a Thumbnail")+'</h4><div class="selector clearfix"><div class="arrows clearfix">','<span class="left"><a href="#" class="arrow disabled">&nbsp;</a></span>','<span class="right"><a href="#" class="arrow ',c.length>1?'enabled':'disabled','">&nbsp;</a></span>','</div><div class="counter"><span>1 of ',c.length,'</span></div></div>'];for(var e=0;e<c.length;e++)b.push('<div class="thumbnail',e==0?' thumbnail_selected':' thumbnail_unselected','">','<img class="img_loading" src="',c[e].src,'" onload="adjustImage(this);" />','</div>');b.push('<label style="white-space:nowrap"><input name="no_picture" type="checkbox" onclick="this.parentNode.parentNode.parentNode.thumbnail.use_thumbnail(this.checked)" />'+_tx("No Picture")+'</label></div>');f.innerHTML=b.join('');this.images=c;this.input=d;d.value=this.images[0].src;this.obj=f;this.obj.thumbnail=this;this.label=f.getElementsByTagName('span')[2];this.index=0;var a=f.getElementsByTagName('a');this.left=a[0];this.right=a[1];this.left.onclick=this.left_arrow_press.bind(this);this.right.onclick=this.right_arrow_press.bind(this);this.left.onselectstart=this.right.onselectstart=function(){return false;};this.left.onmousedown=this.right.onmousedown=this._onmousedown;this.left.onmouseout=this.right.onmouseout=this._onmouseout;}copy_properties(ThumbnailSelector.prototype,{use_thumbnail:function(a){if(!a){this.move_selection(0);CSS.removeClass(this.obj,'thumbnail_dont_use');}else{this.input.value='';CSS.addClass(this.obj,'thumbnail_dont_use');}},_onmousedown:function(){CSS.addClass(this,'active');return false;},_onmouseout:function(){CSS.removeClass(this,'active');},left_arrow_press:function(){CSS.addClass(this.left,'active');this.move_selection(-1);return false;},right_arrow_press:function(){CSS.removeClass(this.right,'active');this.move_selection(1);return false;},move_selection:function(f){var d=this.index+f;if(d>=0&&d<this.images.length){var b=this.obj.getElementsByTagName('div');var e=0;this.index=d;for(var c=0;c<b.length;c++){var a=b[c].className;if(!CSS.hasClass(b[c],'thumbnail '))continue;var g=e==d;if(a.indexOf(g?'_unselected':'_selected')!=-1)CSS.setClass(b[c],a.replace(/thumbnail_(?:un)?selected/,g?'thumbnail_selected':'thumbnail_unselected'));e++;}this.label.innerHTML=_tx("{selected} of {total}",{selected:(d+1),total:e});CSS.setClass(this.left,this.left.className.replace(/[^ ]+abled/,d==0?'disabled':'enabled'));CSS.setClass(this.right,this.right.className.replace(/[^ ]+abled/,d==this.images.length-1?'disabled':'enabled'));this.input.value=this.images[d].src;}}});function ImageSandbox(){this.obj=document.createElement('div');this.obj.style.left=this.obj.style.top='-100px';this.obj.style.width=this.obj.style.height='1px';this.obj.style.overflow='hidden';this.images=0;this.done=0;DOM.getRootElement().appendChild(this.obj);}copy_properties(ImageSandbox.prototype,{loadImages:function(b){this.images=b.length;for(var a=0;a<b.length;a++)new ImageSandboxLoader(this,b[a]);},onImageLoaded:function(a){this.done++;this._stateChange();},onImageFailed:function(a){a.destroy();this.images--;this._stateChange();},getImages:function(){var c=new Array();var a=this.obj.getElementsByTagName('img');for(var b=0;b<a.length;b++)c.push(a[b]);return c;},_stateChange:function(){if(this.done==this.images)if(this.onfinish)this.onfinish();}});function ImageSandboxLoader(b,a){this._timeout=4000;this._start=new Date().getTime();this._sandbox=b;if(typeof a!='object')a={src:a};this._obj=document.createElement('img');this._obj.onload=function(){if(this._pollImage)this._pollImage(1);}.bind(this);this._obj.onerror=function(){if(this._pollImage)this._pollImage(2);}.bind(this);copy_properties(this._obj,a);this._sandbox.obj.appendChild(this._obj);if(this._pollImage!==null)this._pollImage();}copy_properties(ImageSandboxLoader.prototype,{_pollImage:function(a){if(a==1){this._pollImage=null;this._sandbox.onImageLoaded(this);}else if(a==2){this._pollImage=null;this._sandbox.onImageFailed(this);}else if(image_has_failed(this._obj)){this._pollImage(2);}else if(image_has_loaded(this._obj)){this._pollImage(1);}else if((this._start+this._timeout)<new Date().getTime()){this._pollImage(2);}else setTimeout(function(){if(this._pollImage)this._pollImage();}.bind(this),20);},destroy:function(){DOM.remove(this._obj);this._obj=null;}});
function UrlDetector(a){this.element=a;this.lastCharCount=0;this.lastScrapedURL=null;this.detectionInterval=null;this.suppressDetection=bagofholding;Event.listen(a,'focus',this.startDetectionInterval.bind(this));Event.listen(a,'blur',this.stopDetectionInterval.bind(this));var b=DOM.isNode(this.element,['input','textarea']);copy_properties(this,{getText:b?function(){return this.element.value;}:function(){return DOM.getText(this.element);},setText:b?function(c){this.element.value=c;}:function(c){DOM.setContent(this.element,c);}});}UrlDetector.mixin('Arbiter',{getText:bagofholding,setText:bagofholding,setSuppressDetectionCheck:function(a){this.suppressDetection=a;},startDetectionInterval:function(){if(this.detectionInterval||this.suppressDetection())return;this.detectionInterval=setInterval(this.detectionIntervalFire.bind(this),250);},stopDetectionInterval:function(){this.detectionInterval=clearInterval(this.detectionInterval);},detectionIntervalFire:function(){if(this.suppressDetection())return;var a=this.getText().length;if((a-this.lastCharCount)>5||(this.lastCharCount==0&&a>1))var b=true;this.lastCharCount=a;var c=this.detectUrl(b);if(c)this.inform('urlDetected',c);},detectUrl:function(d){var g='',f=this.getText(),e=-1,a=-1;if(d){g=f.match(/(?:^|[^a-z])(www\.\S+)/mi);if(g){e=f.indexOf(g[1]);a=e+g[1].length;g="http://"+g[1];}else{var c=f.match(/(http|fb):\/\/\S*/i);if(c){g=c[0];e=f.indexOf(c[0]);a=e+c[0].length;}}}else{g=f.match(/(?:^|[^a-z])(www\.\S+[\s|\)|\!])/mi);if(g){e=f.indexOf(g[1]);a=e+g[1].length;g="http://"+g[1];}else{var c=f.match(/(http|fb):\/\/\S*[\s|\)|\!]/i);if(c){g=c[0];e=f.indexOf(c[0]);a=e+c[0].length;}}}if(g){g=g.replace(/[\s|\)]/g,'');while(true){var b=g.charAt(g.length-1);if(!b.match(/[,|.|\!]/))break;g=g.substr(0,g.length-1);}if(g!=this.lastScrapedURL){this.lastScrapedURL=g;if(g.search('fb:')==0)this.setText(f.substr(0,e)+f.substr(a));}else g='';}return g;}});
function fix_attachment_more_menu_alignment(d){var a=ge('attachment_buttons_list');var j=a.offsetWidth;if(d){var f=Vector2.getElementPosition(d).x;var b=Vector2.getElementPosition(a).x;var g=f-b;var c=d.offsetWidth;var i=j-g;if(i>=c&&i<126){var e=ge('wall_more_menu');var h=0;e.style.left='auto';e.style.right=h+'px';}}}function wall_video_thumb_adjust(a,b){if(ua.ie()>=6&&ua.ie()<7){a.style.marginTop=(-1*b.height-3)+'px';a.style.paddingTop=(b.height-19)+'px';}a.style.display='block';}function attachments(a){this.attachment_added=false;this.attachment_oid=null;this.attachment_app_id=null;this.is_share=false;this.attached_share=false;this.scrape_last_count=0;this.dialog=null;this.wall_attachments={};this.last_url_scraped=null;this.context=a;this.edit_container_id='attachment_edit_container_'+a;this.edit_loading_id='attachment_edit_loading_'+a;this.edit_id='attachment_edit_'+a;this.view_container_id='attachment_view_container_'+a;this.view_wrapper_id='attachment_view_wrapper_'+a;this.view_id='attachment_view_'+a;this.remove_id='attachment_remove_'+a;this.view_loading_id='attachment_view_loading_'+a;this.is_active=false;}attachments.prototype.show_edit_loading=function(){show(this.edit_loading_id);};attachments.prototype.hide_edit_loading=function(){hide(this.edit_loading_id);};attachments.prototype.show_attachment_edit=function(g,d,f,a){this.is_active=true;if(this.dialog)return;var e=(f==14);this.is_share=(f==100);var h='<div id="'+this.edit_container_id+'">'+'<div id="'+this.edit_loading_id+'">&nbsp;</div>'+'</div>';this.dialog=new Dialog().setImmediateRendering(true).setClassName('attachment_dialog').setTitle(g).setBody(h).setStackable(true).setButtons([Dialog.newButton('attach',_tx("Attach"),'',function(){if(this.is_share){this._share_attach();}else this._attach(e,a,true);this.dialog.hide();this.dialog=null;this.is_active=false;}.bind(this)),Dialog.newButton('cancel',_tx("Cancel"),'inputaux',function(){this.dialog.hide();this.remove_attachment_view();this.dialog=null;this.is_active=false;}.bind(this))]).show();var b=ge(this.edit_container_id);var c=document.createElement('div');c.className='share_stage';CSS.addClass(c,'attachment_edit');c.id=this.edit_id;c.is_app=e;b.appendChild(c);DOM.setContent(c,HTML(d));return c;};attachments.prototype._show_attachment_view=function(c,d){var a=ge(this.view_container_id);var b=document.createElement('div');b.className='share_stage';CSS.addClass(b,'attachment_view');b.id=this.view_id;b.is_app=d;a.appendChild(b);DOM.setContent(b,HTML(c));hide('attachment_buttons_list');var e=ge(this.view_wrapper_id);e.style.display='block';this.attachment_added=true;return b;};attachments.prototype.remove_attachment_view=function(){var c=ge(this.view_container_id);var a=ge(this.view_id);if(this.attachment_added&&a){this.removed=true;c.removeChild(a);hide(this.view_wrapper_id);if(ge('attachment_buttons_list'))show('attachment_buttons_list');var b=ge(this.remove_id);CSS.setClass(b,b.className.replace(' edit',''));}this.attachment_added=false;this.attachment_oid=null;this.attachment_app_id=null;this.is_share=false;this.attached_share=false;};attachments.prototype.get_all_form_elements=function(a){var f=[];if(a){var b=a.getElementsByTagName('input');for(var e=0;e<b.length;e++)f.push(b[e]);var c=a.getElementsByTagName('select');for(var e=0;e<c.length;e++)f.push(c[e]);var d=a.getElementsByTagName('textarea');for(var e=0;e<d.length;e++)f.push(d[e]);}return f;};attachments.prototype._add_attachment_input_data=function(b,a){if(!a)return false;var e=this.get_all_form_elements(a);if(a.is_app){b.attachment={app:{},type:14};for(var d=0;d<e.length;d++)if(!(e[d].type=="radio"||e[d].type=="checkbox")||e[d].checked)b.attachment.app[e[d].name]=e[d].value;}else{var c=false;for(var d=0;d<e.length;d++){if(e[d].name=='attachment[type]')c=true;if(e[d].name=='attachment[params][url]')if(!e[d].value||e[d].value=='http://')return false;b[e[d].name]=e[d].value;}if(!c)return false;}b.context=this.context;return true;};attachments.prototype._attach=function(f,b,e){var c={};if(e){var d=ge(this.edit_id);var a=this._add_attachment_input_data(c,d);if(!a)return;}if(b)for(var i in b)c[i]=b[i];var g=ge(this.view_loading_id);g.style.display='block';var j=this._show_attachment_view('',f);var h=function(k){var l=k.getPayload();if(!j.removed){hide(this.view_loading_id);DOM.setContent(j,HTML(l.html));this.attachment_oid=l.oid;this.attachment_app_id=l.app_id;}}.bind(this);new AsyncRequest().setHandler(h).setURI('/ajax/attachments.php').setErrorHandler(this.remove_attachment_view).setData(c).send();};attachments.prototype.add_post_data=function(a){if(this.attachment_added)if(this.attached_share){this._add_attachment_input_data(a,ge(this.view_id));}else a.attachment={oid:this.attachment_oid,app_id:this.attachment_app_id};};attachments.prototype.prepare_wall_post=function(){var a=ge(this.view_id);if(a){var c=this.get_all_form_elements(a);for(var b=0;b<c.length;b++)c[b].disabled=true;}};attachments.prototype.show_full_attachment=function(a){if(typeof this.wall_attachments[a]!='string')return;hide('attachment_compact_'+a);hide('attached_item_info_'+a);hide('attachment_compact_td_'+a);attachment_div=ge('wall_attachment_'+a);DOM.setContent(attachment_div,HTML(this.wall_attachments[a]));};attachments.prototype.fix_app_inputs_on_send=function(){var a=ge(this.view_id);if(!this.attachment_added||!a)return;function b(e,f){return $N('input',{name:e,id:e,value:f,type:'hidden'});}if(!this.attached_share){new_inputs=[];new_inputs.push(b('attachment[oid]',this.attachment_oid));new_inputs.push(b('attachment[app_id]',this.attachment_app_id));if(a.is_app){new_inputs.push(b('attachment[type]',14));new_inputs.push(b('attachment[app][message_sent]',true));}for(var c=0,d=new_inputs.length;c<d;c++)a.appendChild(new_inputs[c]);}};attachments.prototype.share_attach_from_dialog=function(){this._share_attach();Dialog.getCurrent().hide();this.dialog=null;};attachments.prototype._share_attach=function(){var a=ge('share_link');var b=a.value;if(b&&b!='http://')this._share_submit_url(b);};attachments.prototype._share_submit_url=function(c){this._show_attachment_view(this.share_html_block,false);var d=ge(this.view_container_id);var b=d.childNodes[0].childNodes[0].childNodes[0];this._attach_link_url(b,c,true);var a=ge(this.remove_id);a.className+=' edit';this.attached_share=true;};attachments.prototype._attach_link_url=function(c,e,d){var b=function(f){this.remove_attachment_view();AsyncResponse.defaultErrorHandler(f);}.bind(this);var a=ComposerAttachment.newFromURL(e,b);a.containerReady(c,d);};attachments.prototype._is_fb_code_url=function(a){return a.search('fb:')==0;};attachments.prototype._auto_attach_link=function(event,b){if(this._is_fb_code_url(b)){var a={code:b,context:this.context};this._attach(true,a,false);}else this._share_submit_url(b);};attachments.prototype.register_url_detection=function(b){var a=new UrlDetector($(b));a.subscribe('urlDetected',this._auto_attach_link.bind(this));a.setSuppressDetectionCheck(function(){return this.attachment_added;}.bind(this));};
function scribe_log(a,b){new AsyncSignal('/ajax/scribe_log.php',{category:a,message:b}).send();}function textLimit(b,a){var c=ge(b);if(c.value.length>a){c.value=c.value.substring(0,a);if(arguments.length>2)$(arguments[2]).style.display='block';}}function textLimitStrict(h,d,e,a,f){var g=ge(h);if(g){var c=g.value.length;var b=c-d;if(b>0){if(b>25000){g.value=g.value.substring(0,d+25000);b=25000;}$(e).style.display='block';$(a).innerHTML=b;$(f).disabled=true;}else if(c==0){$(e).style.display='none';$(f).disabled=true;$(a).innerHTML=1;}else if($(a).innerHTML!=0){$(a).innerHTML=0;$(e).style.display='none';$(f).disabled=false;}}}function city_selector_onfound(a,b){a.value=b?b.i:-1;}function city_selector_onselect(a){if(window[a])window[a]();}
var TargetedPrivacyConsts={GENDER_BOTH:0,GENDER_MALE:1,GENDER_FEMALE:2,LOC_ALL:0,LOC_REGION:1,LOC_CITY:2};function TargetedPrivacyModel(){this.value=PrivacyBaseValue.EVERYONE;this.countries=[];this.countries_names=[];this.location_type=TargetedPrivacyConsts.LOC_ALL;this.location_ids=[];this.location_ids_names=[];this.locales=[];this.locales_names=[];this.gender=TargetedPrivacyConsts.GENDER_BOTH;this.age_min=0;this.age_max=0;return this;}TargetedPrivacyModel.prototype={init:function(m,c,d,j,h,i,b,a,e,f,g,k,l){this.value=m;this.countries=c.clone();this.countries_names=d.clone();this.location_type=j;this.location_ids=h.clone();this.location_ids_names=i.clone();this.age_min=b;this.age_max=a;this.gender=e;this.locales=f.clone();this.locales_names=g.clone();this.see_regions=l;this.see_cities=k;},getData:function(){var d={};if(this.value==PrivacyBaseValue.EVERYONE)return d;var b=['countries','location_type','location_ids','age_min','age_max','gender','locales'];for(var c=0;c<b.length;++c){var a=b[c];d[a]=this[a];}return d;}};
function UITargetedPrivacyWidget(){this.parent.construct(this);}copy_properties(UITargetedPrivacyWidget,{DIALOG_URI:'/ajax/privacy/targeted_privacy_widget_dialog.php',instances:{},getInstance:function(a){return this.instances[a];}});UITargetedPrivacyWidget.extend('BasePrivacyWidget');UITargetedPrivacyWidget.mixin('Arbiter',{init:function(d,a,c){var b={useLegacyFormData:true};this.parent.init(a,b);this._profileId=c;this._model=new TargetedPrivacyModel();this._formDataKey='targeted_privacy_data';UITargetedPrivacyWidget.instances[this._controllerId]=this;this._initSelector(d);this._saveFormData();},reset:function(){this._model=new TargetedPrivacyModel();this._updateSelector();this._saveFormData();return this;},_onMenuSelect:function(a){if(a==PrivacyBaseValue.EVERYONE)this._model=new TargetedPrivacyModel();this._saveFormData();this._updateSelector();if(this._isCustomSetting(a))this._showDialog();},_showDialog:function(){var a={controller_id:this._controllerId,profile_id:this._profileId};this._dialog=new Dialog().setAsync(new AsyncRequest().setURI(UITargetedPrivacyWidget.DIALOG_URI).setData(a)).setModal(true).show();}});
function FeedFormBase(){this._storyType=63;this._feedData=null;this._uri='/fbml/ajax/prompt_feed.php';this._buttonCallback=null;this._isNile=false;this._supportsUserMessage=false;this._userMessagePrompt='';this._userMessage={value:''};this._privacyWidget=null;this._currentSize=0;this._connectLocation=0;this._postId=null;this._hasTargets=false;this._profileType=0;this._targeted=false;}FeedFormBase.SIZES={small:1,medium:2};FeedFormBase.AUTO_PUBLISH_OPTIONS={never:2,small:4,medium:5};FeedFormBase.PROFILE_TYPE={user:101,page:102,group:103};FeedFormBase.shouldShowLoadingToSelf=false;FeedFormBase.shouldShowLoadingToOthers=false;FeedFormBase.prototype.setStoryType=function(a){this._storyType=a;return this;};FeedFormBase.prototype.setProfileType=function(a){this._profileType=a;return this;};FeedFormBase.prototype.setForm=function(a){if(this._elements)return null;this._form=$(a);return this;};FeedFormBase.prototype.setElements=function(a){if(this._form)return null;this._elements=a;return this;};FeedFormBase.prototype.setFeedData=function(a){this._feedData=a;return this;};FeedFormBase.prototype.setAppId=function(a){this._appid=a;return this;};FeedFormBase.prototype.setConnectLocation=function(a){this._connectLocation=a;return this;};FeedFormBase.prototype.setUserMessagePrompt=function(a){this._userMessagePrompt=a;return this;};FeedFormBase.prototype.setUserMessage=function(a){if(a)if(typeof a=='string'){this._userMessage={value:a};}else this._userMessage=a;return this;};FeedFormBase.prototype.setURI=function(a){this._uri=a;return this;};FeedFormBase.prototype.setContinuation=function(a){this._continuation=a;return this;};FeedFormBase.prototype.setButtonCallback=function(a){this._buttonCallback=a;return this;};FeedFormBase.prototype.setPrivacyWidget=function(a,b){this._targeted=b;if(b){this._privacyWidget=UITargetedPrivacyWidget.getInstance(a);}else this._privacyWidget=UIPrivacyWidget.getInstance(a);return this;};FeedFormBase.prototype._selectSize=function(a){var b=a.size;if(b!=this._currentSize){CSS.removeClass(this._selectedSize,'Tabset_selected');animation($('preview_'+this._currentSize)).to('opacity',0).hide().duration(150).go();animation($('preview_'+b)).duration(150).checkpoint().show().from('opacity',0).to('opacity',1).duration(150).go();this._selectedSize=a;this._currentSize=b;CSS.addClass(this._selectedSize,'Tabset_selected');}return false;};FeedFormBase.prototype.attachHandlers=function(a){if(!this._isNile)this._attachSizeHandlers(a);var b=DOM.scry($('preview_container'),'a');b.forEach(function(c){Event.listen(c,'click',function(d){d.kill();});});if(this._supportsUserMessage)$('feedform_user_message').focus();return this;};FeedFormBase.prototype._attachSizeHandlers=function(b){var f=this._selectorOptions;var d=this._feedformFilter;for(var c=0;c<f.length;c++){var e=$(d+'_'+f[c].size);var a=$(d+'_'+f[c].size+'_anchor');var g=f[c].size;f[c].node=e;if(CSS.hasClass(e,'Tabset_selected')){this._selectedSize=f[c];this._currentSize=g;}Event.listen(a,'click',this._selectSize.bind(this,f[c]));}return true;};FeedFormBase.prototype._finish=function(){this._enableSubmitButtons();if(this._dialog)this._dialog.hide();if(this._continuation)this._continuation(this._postId,null,{user_message:this._userMessage.value});};FeedFormBase.prototype.shouldShowLoading=function(){return false;};FeedFormBase.prototype.showDialog=function(a){this._dialog=new Dialog().setContentWidth(580).setClassName('interaction_form').setAsync(a).setHandler(this.handleButton.bind(this)).onloadRegister(this.attachHandlers.bind(this));if(this.shouldShowLoading())this._dialog.show();return this;};FeedFormBase.prototype._confirm=function(b){if(this._isNile&&this._supportsUserMessage){user_message=Input.getValue($('feedform_user_message'));this._userMessage.value=b.user_message=user_message;}var a=new AsyncRequest().setURI(this._uri).setData(b).setNectarActionData().setHandler(this.showConfirmed.bind(this));new Dialog().setAsync(a);};FeedFormBase.prototype.handleButton=function(a){if(this._buttonCallback)this._buttonCallback(a);if(a.name=="publish"){var b=this._dialog?this._dialog.getButtonElement(a.name):a;if(b)b.disabled=true;this.confirmFeed();return false;}else if(a.name=="cancel")this.cancelFeed();};FeedFormBase.prototype.cancelFeed=function(){this._finish();};FeedFormBase.prototype.attachProperties=function(a){copy_properties(this,a);if(this._continuationJS){this._continuation=new Function(this._continuationJS);delete this._continuationJS;}return this;};FeedFormBase.prototype._showBase=function(b){var a=new AsyncRequest().setURI(this._uri).setHandler(function(c){var d=c.getPayload().userData;this.attachProperties(d);if(d.no_dialog_shown)this._finish();return true;}.bind(this)).setNectarActionData().setErrorHandler(this._showApplicationError.bind(this)).setData(b);this.showDialog(a);return this;};FeedFormBase.prototype.showConfirmed=function(b){var a;if(this._profileType==FeedFormBase.PROFILE_TYPE.page){a=_tx("The post is now visible on the Page's Wall and home pages of people who like this.");}else if(this._profileType==FeedFormBase.PROFILE_TYPE.group){a=_tx("The post is now visible on the group's Wall.");}else if(this._hasTargets){a=_tx("The post is now visible on your friend's Wall.");}else a=_tx("The post is now visible on your Wall and your friends' home pages.");this.showConfirmedWithMessage(a,b);};FeedFormBase.prototype.showConfirmedWithMessage=function(c,e){this.attachProperties(e.payload.userData);var b='<div class="interim_status">'+c+'</div>';var f=_tx("Post Published");if(this._dialog){this._dialog.setBody(b);this._dialog.setTitle(f);this._dialog.setButtons(Dialog.OK);this._dialog.setButtonsMessage('');}else{$('dialog_body').innerHTML=b;var d=ge('publish');if(d!=null)DOM.remove(d);if(this._privacyWidget)DOM.remove(this._privacyWidget.getRoot());var a=ge('cancel');if(a!=null)a.value=_tx("Done");}setTimeout(this._finish.bind(this),2500);return false;};FeedFormBase.prototype._enableSubmitButtons=function(){var b=['send','publish'];for(var c=0;c<b.length;c++){var a=ge(b[c]);if(a){a.disabled=false;break;}}};FeedFormBase.prototype._showApplicationError=function(b){this._enableSubmitButtons();var d=b.getPayload().userData;var c=function(f){var g=_tx("There was an application error. Please try again later.");var e=null;if(f){if(d&&d.errorTitle){g=d.errorTitle;}else if(b.getErrorSummary)g=b.getErrorSummary();if(d&&d.errorMessage){e=d.errorMessage;}else if(b.getErrorDescription)e=b.getErrorDescription();}ErrorDialog.show(g,e);};var a=b.getError();if(a==1349008){if(d.showDebug){c(true);}else if(this._continuation){this._continuation();}else c(false);}else c(true);return false;};function FeedForm(){this.parent.construct(this);}FeedForm.extend('FeedFormBase');FeedForm.attachSubmitHandler=function(b,a){b.onsubmit='';Event.listen(b,'submit',function(d,c,event){FeedForm.shouldShowLoadingToSelf=true;new FeedForm().setForm(d).setAppId(c).show();return false;}.curry(b,a));};FeedForm.prototype._setPublishButtonText=function(a){this.publish_button.value=a;};FeedForm.prototype._setCancelButtonText=function(a){this.cancel_button.value=a;};FeedForm.prototype.shouldShowLoading=function(){return FeedForm.shouldShowLoadingToSelf;};FeedForm.prototype.show=function(){var b={};if(this._form){b={callback:Form.getAttribute(this._form,'action'),elements:Form.serialize(this._form)};}else if(this._elements)b.elements=this._elements;var a={app_id:this._appid,feedform_type:this._storyType,feed_info:this._feedData,user_message_prompt:this._userMessagePrompt,user_message:this._userMessage.value,preview:true,feed_target_type:'self_feed',extern:this._connectLocation};copy_properties(a,b);return this._showBase(a);};FeedForm.prototype.cancelFeed=function(){this._finish();};FeedForm.prototype.confirmFeed=function(){var a={feed_info:this._feedData,feedform_type:this._storyType,preview:false,feed_target_type:'self_feed',app_id:this._appid,size:FeedFormBase.SIZES[this._currentSize],extern:this._connectLocation};if(this._privacyWidget)if(this._targeted){a.targeted_privacy_data=this._privacyWidget.getData();}else a.privacy_data=this._privacyWidget.getData();this._confirm(a);};function MultiFeedForm(){this.parent.construct(this);this._hasTargets=true;}MultiFeedForm.extend('FeedFormBase');MultiFeedForm.prototype.setPrefillId=function(a){if(a>0){this._prefillId=a;}else this._prefillId=null;return this;};MultiFeedForm.prototype.removeRecipient=function(a){this._toIds=this._toIds.filter(function(b){return b!=a;});if(this._toIds.length==0){this._finish();}else DOM.remove('sp'+a);return false;};MultiFeedForm.prototype.confirmFeed=function(){var a={feed_info:this._feedData,feedform_type:this._storyType,to_ids:this._toIds,preview:false,feed_target_type:'multi_feed',app_id:this._appid,size:FeedFormBase.SIZES[this._currentSize],extern:this._connectLocation};this._confirm(a);};MultiFeedForm.prototype.shouldShowLoading=function(){return FeedFormBase.shouldShowLoadingToOthers;};MultiFeedForm.prototype.show=function(){var c=[];if(this._prefillId){c.push(this._prefillId);}else{var d=this._form.getElementsByTagName('input');for(var b=0;b<d.length;b++)if(d[b].getAttribute('fb_protected')=='true'&&(CSS.hasClass(d[b],'fb_token_hidden_input')||d[b].name=='ids[]'||d[b].name=='friend_selector_id')&&(d[b].type!='checkbox'||d[b].checked))c.push(d[b].value);}this._toIds=c;var a={app_id:this._appid,to_ids:this._toIds,callback:this._form.action,preview:true,form_id:this._form.id,prefill:(this.prefillId>0),elements:Form.serialize(this._form),user_message_prompt:this._userMessagePrompt,user_message:this._userMessage.value,feed_target_type:'multi_feed',extern:this._connectLocation};return this._showBase(a);};MultiFeedForm.prototype.attachHandlers=function(a){for(var b=0;b<this._toIds.length;b++){var c=ge('spl_'+this._toIds[b]);if(c)c.onclick=this.removeRecipient.bind(this,this._toIds[b]);}this.parent.attachHandlers(a);return this;};function TargetFeedForm(){this.parent.construct(this);}TargetFeedForm.extend('MultiFeedForm');TargetFeedForm.prototype.confirmFeed=function(){var a={feed_info:this._feedData,feedform_type:this._storyType,to_ids:this._toIds,preview:false,feed_target_type:'target_feed',app_id:this._appid,size:FeedFormBase.SIZES[this._currentSize],extern:this._connectLocation};this._confirm(a);};TargetFeedForm.prototype.setTarget=function(a){this._toIds=[a];return this;};TargetFeedForm.prototype.show=function(){var a={app_id:this._appid,to_ids:this._toIds,feed_info:this._feedData,preview:true,prefill:(this.prefillId>0),user_message_prompt:this._userMessagePrompt,user_message:this._userMessage.value,feed_target_type:'target_feed',extern:this._connectLocation};return this._showBase(a);};
function typeaheadpro(a,c,b){if(!typeaheadpro.hacks){typeaheadpro.should_check_missing_events=ua.safari()<500;typeaheadpro.should_simulate_keypress=ua.ie()||(ua.safari()>500&&ua.safari()<523||ua.safari()>=525);if(typeaheadpro.should_use_iframe==undefined)typeaheadpro.should_use_iframe=ua.ie()<7;typeaheadpro.should_use_overflow=ua.opera()<9.5||ua.safari()<500;if(ua.firefox())this.activate_poll_on_focus_events=true;typeaheadpro.hacks=true;}typeaheadpro.instances=(typeaheadpro.instances||[]);typeaheadpro.instances.push(this);this.instance=typeaheadpro.instances.length-1;copy_properties(this,b||{});this.obj=a;this.obj.typeahead=this;this.attachEventListeners();this.want_icon_list=false;this.showing_icon_list=false;this.stop_suggestion_select=false;if(this.typeahead_icon_class&&this.typeahead_icon_get_return){this.typeahead_icon=document.createElement('div');CSS.addClass(this.typeahead_icon,'typeahead_list_icon');CSS.addClass(this.typeahead_icon,this.typeahead_icon_class);this.typeahead_icon.innerHTML='&nbsp;';this.setup_typeahead_icon();setTimeout(function(){this.focus();}.bind(this),50);this.typeahead_icon.onmousedown=function(event){return this.typeahead_icon_onclick(event||window.event);}.bind(this);}this.focused=this.focused||this.obj.offsetWidth?true:false;this.focused=this.focused&&!this.enumerate_on_focus;this.anchor=this.setup_anchor();this.dropdown=document.createElement('div');CSS.addClass(this.dropdown,'typeahead_list');if(!this.focused)this.dropdown.style.display='none';this.anchor_block=this.anchor_block||this.anchor.tagName.toLowerCase()=='div';document.body.appendChild(this.dropdown);this.dropdown.className+=' typeahead_list_absolute';this.list=$N('div');this.dropdown.appendChild(this.list);this.dropdown.onmousedown=function(event){return this.dropdown_onmousedown(event||window.event);}.bind(this);if(typeaheadpro.should_use_iframe&&!typeaheadpro.iframe){typeaheadpro.iframe=document.createElement('iframe');typeaheadpro.iframe.src="/common/blank.html";CSS.setClass(typeaheadpro.iframe,'typeahead_iframe');typeaheadpro.iframe.style.display='none';typeaheadpro.iframe.frameBorder=0;document.body.appendChild(typeaheadpro.iframe);}if(typeaheadpro.should_use_iframe&&typeaheadpro.iframe)typeaheadpro.iframe.style.zIndex=parseInt(CSS.getStyle(this.dropdown,'zIndex'))-1;this.log_data={kt:0,kp:0,sm:null,ty:0,f:1};this.results_text='';this.last_key_suggestion=0;this.status=2;this.clear_placeholder();if(c)this.set_source(c);if(this.source){this.selectedindex=-1;if(this.focused){this._onfocus();this.show();this._onkeyup();this.set_class('');this.capture_submit();}}else this.hide();onleaveRegister(this._onunload.bind(this),true);}typeaheadpro.prototype.enumerate=false;typeaheadpro.prototype.interactive=false;typeaheadpro.prototype.changed=false;typeaheadpro.prototype.render_block_size=50;typeaheadpro.prototype.typeahead_icon_class=false;typeaheadpro.prototype.typeahead_icon_get_return=false;typeaheadpro.prototype.old_value=null;typeaheadpro.prototype.poll_handle=null;typeaheadpro.prototype.activate_poll_on_focus_events=false;typeaheadpro.prototype.suggestion_count=0;typeaheadpro.prototype.clear_value_on_blur=true;typeaheadpro.prototype.max_results=0;typeaheadpro.prototype.max_display=10;typeaheadpro.prototype.allow_placeholders=false;typeaheadpro.prototype.auto_select=true;typeaheadpro.prototype.auto_select_exactmatch=false;typeaheadpro.prototype.enumerate_on_focus=false;typeaheadpro.dirty_instances=function(){if(typeaheadpro.instances)typeaheadpro.instances.forEach(function(a){a.update_status(2);if(a.source)a.source.is_ready=false;});};typeaheadpro.prototype.set_source=function(a){this.source=a;this.source.set_owner(this);this.status=0;this.cache={};this.last_search=0;this.suggestions=[];};typeaheadpro.prototype.setup_anchor=function(){return this.obj;};typeaheadpro.prototype.destroy=function(){if(this.typeahead_icon){DOM.remove(this.typeahead_icon);this.toggle_icon_list=function(){};}this.clear_render_timeouts();if(!this.anchor_block&&this.anchor.nextSibling.tagName.toLowerCase()=='br')DOM.remove(this.anchor.nextSibling);if(this.dropdown)DOM.remove(this.dropdown);if(this.obj){this.removeEventListeners();this.obj.typeahead=null;DOM.remove(this.obj);}this.anchor=this.obj=this.dropdown=null;delete typeaheadpro.instances[this.instance];};typeaheadpro.prototype.check_value=function(){if(this.obj){var a=this.obj.value;if(a!=this.old_value){this.dirty_results();this.old_value=a;if(this.old_value==='')this._onselect(false);}}};typeaheadpro.prototype._onkeyup=function(a){a=$E(a);this.last_key=a?a.keyCode:-1;if(this.key_down==this.last_key)this.key_down=0;var b=true;switch(this.last_key){case KEYS.ESC:this.selectedindex=-1;this._onselect(false);this.hide();a.stop();b=false;break;}return b;};typeaheadpro.prototype._onkeydown=function(a){a=$E(a);this.key_down=this.last_key=a?a.keyCode:-1;this.interactive=true;switch(this.last_key){case KEYS.PAGE_UP:case KEYS.PAGE_DOWN:case KEYS.UP:case KEYS.DOWN:this.log_data.kt+=1;if(typeaheadpro.should_simulate_keypress)this._onkeypress({keyCode:this.last_key});return false;case KEYS.TAB:this.log_data.kt+=1;this.select_suggestion(this.selectedindex);if(a.shiftKey){this.reverse_focus();}else this.advance_focus();break;case KEYS.RETURN:this.log_data.sm='key_ret';if(this.select_suggestion(this.selectedindex))this.hide();if(typeof(this.submit_keydown_return)!='undefined')this.submit_keydown_return=this._onsubmit(this.get_current_selection());return this.submit_keydown_return;case 229:if(!this.poll_handle)this.poll_handle=setInterval(this.check_value.bind(this),100);break;default:this.log_data.kp+=1;setTimeout(bind(this,'check_value'),this.source.check_limit);}};typeaheadpro.prototype._onkeypress=function(a){a=$E(a);var b=1;this.last_key=a?Event.getKeyCode(a):-1;this.interactive=true;switch(this.last_key){case KEYS.PAGE_UP:b=this.max_display;case KEYS.UP:this.set_suggestion(b>1&&this.selectedindex>0&&this.selectedindex<b?0:this.selectedindex-b);this.last_key_suggestion=(new Date()).getTime();return false;case KEYS.PAGE_DOWN:b=this.max_display;case KEYS.DOWN:if(trim(this.get_value())==''&&!this.enumerate){this.enumerate=true;this.results_text=null;this.dirty_results();}else{this.set_suggestion(this.suggestions.length<=this.selectedindex+b?this.suggestions.length-1:this.selectedindex+b);this.last_key_suggestion=(new Date()).getTime();}return false;case KEYS.RETURN:var c=null;if(typeof(this.submit_keydown_return)=='undefined'){c=this.submit_keydown_return=this._onsubmit(this.get_current_selection());}else{c=this.submit_keydown_return;delete this.submit_keydown_return;}a.stop();return c;default:setTimeout(bind(this,'check_value'),this.source.check_limit);break;}return true;};typeaheadpro.prototype._onchange=function(){this.changed=true;};typeaheadpro.prototype._onfound=function(a){return this.onfound?this.onfound.call(this,a):true;};typeaheadpro.prototype._onsubmit=function(a){if(this.onsubmit){var b=this.onsubmit.call(this,a);if(b&&this.obj.form){if(!this.obj.form.onsubmit||this.obj.form.onsubmit())this.obj.form.submit();return false;}return b;}else{this.advance_focus();return false;}};typeaheadpro.prototype._onselect=function(c){var b=(function(){if(this.onselect)this.onselect.call(this,c);}).bind(this);if(c.no_email){var a=new AsyncRequest().setData({action:'require',require_field:'email',uid:c.i}).setMethod('GET').setReadOnly(true).setURI('/friends/ajax/external.php');new Dialog().setCloseHandler(function(e){var d=this.getUserData();if(d){b();}else e.set_value('');}.bind(null,this)).setAsync(a).show();}else b();};typeaheadpro.prototype._onfocus=function(){if(!this.poll_handle&&this.activate_poll_on_focus_events)this.poll_handle=setInterval(this.check_value.bind(this),100);if(this.source)this.source.bootstrap();if(this.last_dropdown_mouse>(new Date()).getTime()-10||this.focused)return;if(this.changed)this.dirty_results();this.focused=true;this.changed=false;this.clear_placeholder();this.results_text='';this.set_class('');this.show();this.capture_submit();if(this.typeahead_icon)show(this.typeahead_icon);if(this.enumerate_on_focus)setTimeout(function(){this.enumerate=true;this.results_text=null;this.dirty_results();this.selectedindex=-1;return false;}.bind(this),0);};typeaheadpro.prototype._onblur=function(event){if(this.last_dropdown_mouse&&this.last_dropdown_mouse>(new Date()).getTime()-10&&this.is_showing_suggestions()){Event.kill(event);setTimeout(function(){this.focus();}.bind(this),0);return false;}if(!this.stop_hiding){if(this.showing_icon_list)this.toggle_icon_list(true);}else{this.focus();return false;}this.focused=false;if(this.changed&&!this.interactive){this.dirty_results();this.changed=false;return;}if(!this.suggestions){this._onselect(false);}else if(this.selectedindex>=0&&(this.auto_select||this.auto_select_exactmatch))this.select_suggestion(this.selectedindex);this.hide();this.update_class();if(this.clear_value_on_blur&&!this.get_value()){var a=this.allow_placeholders?this.source.gen_noinput():'';this.set_value(a?a:'');this.set_class('DOMControl_placeholder');}if(this.poll_handle){clearInterval(this.poll_handle);this.poll_handle=null;}};typeaheadpro.prototype._onunload=function(){if(typeaheadpro.instances[this.instance])this.hide();};typeaheadpro.prototype.typeahead_icon_onclick=function(event){this.stop_hiding=true;this.focus();setTimeout(function(){this.toggle_icon_list();}.bind(this),50);Event.kill(event);return false;};typeaheadpro.prototype.dropdown_onmousedown=function(event){this.last_dropdown_mouse=(new Date()).getTime();};typeaheadpro.prototype.setup_typeahead_icon=function(){this.typeahead_parent=document.createElement('div');CSS.addClass(this.typeahead_parent,'typeahead_parent');this.typeahead_parent.appendChild(this.typeahead_icon);this.obj.parentNode.insertBefore(this.typeahead_parent,this.obj);};typeaheadpro.prototype.mouse_set_suggestion=function(a){if(!this.visible)return;if((new Date()).getTime()-this.last_key_suggestion>50)this.set_suggestion(a);};typeaheadpro.prototype.capture_submit=function(){if(!typeaheadpro.should_check_missing_events)return;if((!this.captured_form||this.captured_substitute!=this.captured_form.onsubmit)&&this.obj.form){this.captured_form=this.obj.form;this.captured_event=this.obj.form.onsubmit;this.captured_substitute=this.obj.form.onsubmit=function(){return ((this.key_down&&this.key_down!=KEYS.RETURN&&this.key_down!=KEYS.TAB)?this.submit_keydown_return:(this.captured_event?this.captured_event.apply(arguments,this.captured_form):true))?true:false;}.bind(this);}};typeaheadpro.prototype.set_suggestion=function(b){this.stop_suggestion_select=false;if(!this.suggestions||this.suggestions.length<=b)return;var c=this.get_suggestion_node(this.selectedindex);this.selectedindex=(b<=-1)?-1:b;var a=this.get_suggestion_node(this.selectedindex);if(c){CSS.removeClass(c,'typeahead_selected');CSS.addClass(c,'typeahead_not_selected');}if(a){CSS.removeClass(a,'typeahead_not_selected');CSS.addClass(a,'typeahead_selected');}this.recalc_scroll();this._onfound(this.get_current_selection());};typeaheadpro.prototype.get_suggestion_node=function(a){var b=this.list.childNodes;return a==-1?null:b[Math.floor(a/this.render_block_size)].childNodes[a%this.render_block_size];};typeaheadpro.prototype.get_current_selection=function(){return this.selectedindex==-1?false:this.suggestions[this.selectedindex];};typeaheadpro.prototype.update_class=function(){if(this.suggestions&&this.selectedindex!=-1&&typeahead_source.flatten_string(this.get_current_selection().t)==typeahead_source.flatten_string(this.get_value())){this.set_class('typeahead_found');}else this.set_class('');};typeaheadpro.prototype.select_suggestion=function(a){if(!this.stop_suggestion_select&&this.current_selecting!=a)this.current_selecting=a;var b=true;if(!this.suggestions||a==undefined||a===false||this.suggestions.length<=a||a<0){this._onfound(false);this._onselect(false);this.selectedindex=-1;this.set_class('');b=false;}else{this.selectedindex=a;var c=this.suggestions[a].ty;if(c!='web'&&c!='search')this.set_value(this.suggestions[a].t);this.set_class('typeahead_found');this._onfound(this.suggestions[this.selectedindex]);this._onselect(this.suggestions[this.selectedindex]);}if(!this.interactive){this.hide();this.blur();}this.current_selecting=null;if(!b&&this.ignore_invalid_suggestion)return false;return true;};typeaheadpro.prototype.is_showing_suggestions=function(){return (this.suggestions)&&(this.suggestions.length>0);};typeaheadpro.prototype.set_value=function(a){this.obj.value=a;};typeaheadpro.prototype.get_value=function(){if(this.showing_icon_list&&this.old_typeahead_value!=this.obj.value)this.toggle_icon_list();if(this.want_icon_list){return this.typeahead_icon_get_return;}else if(this.showing_icon_list)this.toggle_icon_list();return this.obj.value;};typeaheadpro.prototype.found_suggestions=function(p,q,e){if(!p)p=[];this.suggestion_count=p.length;if(!e){this.status=0;this.add_cache(q,p);}this.clear_render_timeouts();if(this.get_value()==this.results_text){return;}else if(!e){this.results_text=typeahead_source.flatten_string(q);if(this.enumerate&&trim(this.results_text)!='')this.enumerate=false;}if(this.dedupe_suggestions){var i=DOM.scry(this.tokenizer.obj,'input.fb_token_hidden_input');if(i.length>0){var d=[];var a=[];for(var h=0;h<i.length;h++)a[i[h].value]=true;for(var h=0,j=p.length;h<j;h++)if(p[h]&&!a[p[h].i])d.push(p[h]);p=d;}}var c=-1;if(this.selectedindex>0||(this.selectedindex==0&&!this.auto_select)){var n=this.suggestions[this.selectedindex].i;for(var h=0,j=p.length;h<j;h++)if(p[h].i==n){c=h;break;}}if(c==-1&&this.auto_select&&p.length){c=0;this._onfound(p[0]);}else if(this.auto_select_exactmatch&&p.length)if(q.toLowerCase()===p[0].t.toLowerCase()){c=0;this._onfound(p[0]);}else c=-1;this.selectedindex=c;this.suggestions=p;if(!e)this.real_suggestions=p;if(p.length){var g=[],b=Math.ceil(p.length/this.render_block_size),k={},f,m=null;DOM.empty(this.list);for(var h=0;h<b;h++)this.list.appendChild(document.createElement('div'));if(c>-1){f=Math.floor(c/this.render_block_size);k[f]=true;if(c%this.render_block_size>this.render_block_size/2){k[f+1]=true;}else if(f!=0)k[f-1]=true;}else k[0]=true;for(var l in k){this.render_block(l);sample=this.list.childNodes[l].firstChild;}this.show();if(b){var o=sample.offsetHeight;this.render_timeouts=[];for(var h=1;h<b;h++)if(!k[h]){this.list.childNodes[h].style.height=o*Math.min(this.render_block_size,p.length-h*this.render_block_size)+'px';this.render_timeouts.push(setTimeout(this.render_block.bind(this,h),700+h*50));}}}else{this.selectedindex=-1;this.set_message(this.status===0?this.source.gen_nomatch():this.source.gen_loading());this._onfound(false);}this.recalc_scroll();if(!e&&this.results_text!=typeahead_source.flatten_string(this.get_value()))this.dirty_results();};typeaheadpro.prototype.render_block=function(a,h){var i=this.suggestions,g=this.selectedindex,j=this.get_value(),d=this.instance,b=[],f=this.list.childNodes[a];for(var c=a*this.render_block_size,e=Math.min(i.length,(a+1)*this.render_block_size);c<e;c++){b.push('<div class="');if(g==c){b.push('typeahead_suggestion typeahead_selected');}else b.push('typeahead_suggestion typeahead_not_selected');if(c>0&&i[c-1].o<0&&i[c].o>=0)b.push(' typeahead_delimiter');b.push('" onmouseover="typeaheadpro.instances[',d,'].mouse_set_suggestion(',c,')" ','onmousedown="var instance=typeaheadpro.instances[',d,']; instance.select_suggestion(',c,');instance.hide();Event.kill(event);">',this.source.gen_html(i[c],j),'</div>');}f.innerHTML=b.join('');f.style.height='auto';CSS.addClass(f,'typeahead_suggestions');};typeaheadpro.prototype.clear_render_timeouts=function(){if(this.render_timeouts){for(var a=0;a<this.render_timeouts.length;a++)clearTimeout(this.render_timeouts[a]);this.render_timeouts=null;}};typeaheadpro.prototype.recalc_scroll=function(){var a=this.list.firstChild;if(!a)return;if(a.childNodes.length>this.max_display){var c=a.childNodes[this.max_display-1];var b=c.offsetTop+c.offsetHeight;this.dropdown.style.height=b+'px';var e=this.get_suggestion_node(this.selectedindex);if(e){var d=this.dropdown.scrollTop;if(e.offsetTop<d){this.dropdown.scrollTop=e.offsetTop;}else if(e.offsetTop+e.offsetHeight>b+d)this.dropdown.scrollTop=e.offsetTop+e.offsetHeight-b;}if(!typeaheadpro.should_use_overflow){this.dropdown.style.overflowY='scroll';this.dropdown.style.overflowX='hidden';}}else{this.dropdown.style.height='auto';if(!typeaheadpro.should_use_overflow)this.dropdown.style.overflowY='hidden';}};typeaheadpro.prototype.search_cache=function(a){return this.cache[typeahead_source.flatten_string(a)];};typeaheadpro.prototype.add_cache=function(b,a){if(this.source.cache_results)this.cache[typeahead_source.flatten_string(b)]=a;};typeaheadpro.prototype.update_status=function(a){this.status=a;this.dirty_results();};typeaheadpro.prototype.set_class=function(a){CSS.setClass(this.obj,(this.obj.className.replace(/typeahead_[^\s]+/g,'')+' '+a).replace(/ {2,}/g,' '));};typeaheadpro.prototype.dirty_results=function(){if(!this.enumerate&&this.get_value().trim()==''){DOM.empty(this.list);this.results_text='';this.set_message(this.source.gen_placeholder());this.suggestions=[];this.selectedindex=-1;return;}else if(this.results_text==typeahead_source.flatten_string(this.get_value())){return;}else if(this.status===2){this.set_message(this.source.gen_loading());return;}var c=(new Date()).getTime();var e=false;if(this.last_search<=(c-this.source.search_limit)&&this.status===0){e=this.perform_search();}else if(this.status===0)if(!this.search_timeout)this.search_timeout=setTimeout(function(){this.search_timeout=false;if(this.status===0)this.dirty_results();}.bind(this),this.source.search_limit-(c-this.last_search));if(this.source.allow_fake_results&&this.real_suggestions&&!e){var d=typeahead_source.tokenize(this.get_value()).sort(typeahead_source._sort);var a=[];for(var b=0;b<this.real_suggestions.length;b++)if(typeahead_source.check_match(d,this.real_suggestions[b].t+' '+this.real_suggestions[b].n))a.push(this.real_suggestions[b]);if(a.length){this.found_suggestions(a,this.get_value(),true);}else{this.selectedindex=-1;this.set_message(this.source.gen_loading());}}};typeaheadpro.prototype.perform_search=function(){if(this.get_value()==this.results_text)return true;var a;if((a=this.search_cache(this.get_value()))===undefined&&!(a=this.source.search_value(this.get_value()))){this.status=1;this.last_search=(new Date()).getTime();return false;}this.found_suggestions(a,this.get_value(),false);return true;};typeaheadpro.prototype.set_message=function(a){this.clear_render_timeouts();if(a){this.list.innerHTML='<div class="typeahead_message">'+a+'</div>';this.reset_iframe();}else this.hide();this.recalc_scroll();};typeaheadpro.prototype.reset_iframe=function(){if(!typeaheadpro.should_use_iframe)return;typeaheadpro.iframe.style.top=this.dropdown.style.top;typeaheadpro.iframe.style.left=this.dropdown.style.left;typeaheadpro.iframe.style.width=this.dropdown.offsetWidth+'px';typeaheadpro.iframe.style.height=this.dropdown.offsetHeight+'px';typeaheadpro.iframe.style.display='';};typeaheadpro.prototype.advance_focus=function(){return this._move_focus(true);};typeaheadpro.prototype.reverse_focus=function(){return this._move_focus(false);};typeaheadpro.prototype._move_focus=function(c){var b=this.obj.form?Form.getInputs(this.obj.form):Form.getInputs();var d=[];d._insert=c?d.push:d.unshift;var e=!c;for(var a=0;a<b.length;a++)if(!c&&b[a]==this.obj){e=false;}else if(e&&b[a].type!='hidden'&&b[a].tabIndex!=-1&&b[a].offsetParent){d._insert(b[a]);}else if(b[a]==this.obj)e=true;setTimeout(function(){for(var g=0;g<this.length;g++)try{if(this[g].offsetParent){this[g].focus();setTimeout(function(){try{this.focus();}catch(h){}}.bind(this[g]),0);return;}}catch(f){}}.bind(d?d:[]),0);this.blur();this.hide();};typeaheadpro.prototype.clear_placeholder=function(){if(CSS.hasClass(this.obj,'DOMControl_placeholder')){this.set_value('');CSS.removeClass(this.obj,'DOMControl_placeholder');}};typeaheadpro.prototype.clear=function(){this.set_value('');this.set_class('');this.selectedindex=-1;this.enumerate=false;this.dirty_results();};typeaheadpro.prototype.hide=function(){if(this.stop_hiding)return;this.visible=false;this.dropdown.style.display='none';this.clear_render_timeouts();if(typeaheadpro.should_use_iframe)typeaheadpro.iframe.style.display='none';};typeaheadpro.prototype.show=function(){this.visible=true;if(this.focused){this.dropdown.style.top=elementY(this.anchor)+this.anchor.offsetHeight+'px';this.dropdown.style.left=elementX(this.anchor)+'px';this.dropdown.style.width=(this.anchor.offsetWidth-2)+'px';this.dropdown.style.display='';if(typeaheadpro.should_use_iframe){typeaheadpro.iframe.style.display='';this.reset_iframe();}}};typeaheadpro.prototype.toggle_icon_list=function(a){if(this.showing_icon_list){this.showing_icon_list=false;this.source.showing_icon_list=false;if(!a)this.focus();CSS.removeClass(this.typeahead_icon,'on_selected');this.want_icon_list=false;this.showing_icon_list=false;this.stop_suggestion_select=true;if(this.obj)this.dirty_results();}else{this.source.showing_icon_list=true;this.old_typeahead_value=this.obj.value;this.stop_suggestion_select=true;this.want_icon_list=true;this.dirty_results();this.focus();CSS.addClass(this.typeahead_icon,'on_selected');this.show();this.set_suggestion(-1);this.showing_icon_list=true;}setTimeout(function(){this.stop_hiding=false;}.bind(this),100);};typeaheadpro.prototype.focus=function(){this.obj.focus();};typeaheadpro.prototype.blur=function(a){if(this.obj)this.obj.blur(a);};typeaheadpro.prototype.attachEventListeners=function(){this._eventRefs=Event.listen(this.obj,{focus:this._onfocus.bind(this),blur:this._onblur.bind(this),change:this._onchange.bind(this),keyup:this._onkeyup.bind(this),keydown:this._onkeydown.bind(this),keypress:this._onkeypress.bind(this)});};typeaheadpro.prototype.removeEventListeners=function(){if(this._eventRefs)for(var a in this._eventRefs)this._eventRefs[a].remove();};typeaheadpro.kill_typeahead=function(a){if(a.typeahead){if(!this.anchor_block)a.parentNode.removeChild(a.nextSibling);a.parentNode.removeChild(a.nextSibling);if(a.typeahead.source)a.typeahead.source=a.typeahead.source.owner=null;a.typeahead.removeEventListeners();a.typeahead=null;}};
var FBML=(function(){var z={};var zq={};function y(zs,zu,zt){var zr=document.createElement('INPUT');zr.name=zs.getAttribute('idname');zr.type='hidden';zr.setAttribute('fb_protected','true');zr.typeahead=this;if(zs.form)zs.form.appendChild(zr);this._idInput=zr;return this.parent.construct(this,zs,zu,zt);}y.extend('typeaheadpro');y.prototype.updateID=function(zr){if(zr.i){this._idInput.value=zr.i;}else if(zr.is){this._idInput.value=zr.is;}else this._idInput.value='';};y.prototype.destroy=function(){this._idInput.parentNode.removeChild(this._idInput);this._idInput.typeahead=null;this._idInput=null;this.parent.destroy();};y.prototype._onselect=function(zr){this.updateID(zr);this.parent._onselect(zr);};var a=new Object();function x(zr){if(window.console)window.console.log('Facebook FBML Mock AJAX ERROR: '+zr);return false;}function g(zr,zs,zu,zt){if(!zr['url'])return x("no input with id url in form");if(!zr['fb_sig_api_key'])return x("no input with id fb_api_key in form");if(zu)zu();f(zr,zs,zt);}function f(zr,zs,zt){new AsyncRequest().setURI('/fbml/ajax/attach.php').setData(zr).setMethod('POST').setHandler(function(zu){if(zt)zt();if(!zs.removed)DOM.setContent(zs,HTML(zu.getPayload().html));}.bind(this)).send();}function h(zs){if(zs=='wall'){var zr=wallAttachments;}else if(zs=='message')var zr=inboxAttachments;if(zr){var zw=ge(zr.edit_id);var zu=zr.get_all_form_elements(zw);var zv=Object();for(var zt=0;zt<zu.length;zt++)if(!(zu[zt].type=="radio"||zu[zt].type=="checkbox")||zu[zt].checked)zv[zu[zt].name]=zu[zt].value;zv.context=zr.context;zv.action='edit';f(zv,zw);}}function j(zr,zu,zv,zw,zs,zt){this.requireLogin(zr,function(){return c(zv,zw,zs,zt);});return false;}function c(zy,zz,zr,zt){var zx=ge(zy);if(!zx)return x("target "+zy+" not found");var zs=zx.getAttribute("fbcontext");var zw=FBML.Contexts[zs];if(!zr)return x("You must either specify a clickrewriteform (an id) or use the clickrewrite attribute inside a form");var zu=typeof this.PROFILE_OWNER_ID=='undefined'?0:this.PROFILE_OWNER_ID;var zv=Form.serialize(zr);zv.fb_mockajax_context=zw;zv.fb_mockajax_context_hash=zs;zv.fb_mockajax_url=zz;zv.fb_target_id=zu;zv.fb_mockajax_rewrite_id=zy;new AsyncRequest().setURI('/fbml/mock_ajax_proxy.php').setMethod("POST").setFBMLForm().setData(zv).setHandler(function(zzb){var zza=zzb.getPayload();if(zza.ok){DOM.setContent(zx,HTML(zza.html));}else return x(zza.error_message);FBML.mockAjaxResponse=zza;return zza.ok;}.bind(this)).setErrorHandler(function(zza){return x("Failed to successfully retrieve data from Facebook when making mock AJAX call to rewrite id "+zy);}.bind(this)).send();if(zt)DOM.setContent(zx,HTML(zt));return false;}function p(zr){return o(zr,"");}function q(zw){var zu=null;if(zu=ge(zw)){var zt=zu.parentNode.innerHTML;zu.id='dialog_invoked_'+zu.id;var zr=parseInt(zu.getAttribute('fb_dialog_width'));var zv=zu.cloneNode(true);DOM.empty(zu);var zs=new Dialog();if(zr)zs.setContentWidth(zr);zs.setImmediateRendering(true).setStackable(true).setBody(zt).setFullBleed(true).show();z[zu.id]={elem:zv,dialog:zs};}return false;}function s(zw){var zs=null;var zr='dialog_invoked_'+zw;for(dialog_id in z)if(zs=ge(dialog_id)){var zu=zs.id.replace('dialog_invoked_','');var zt=null;if(zt=ge(zu))zt.id='dialog_closed_'+zu;var zv=zs.parentNode;DOM.empty(zv);zv.appendChild(z[dialog_id].elem);z[dialog_id].elem.id=zu;}if(z[zr].dialog)z[zr].dialog.hide();}function m(zr){return o(zr,"none");}function r(zs){var zr=ge(zs);if(!zr){return x("Could not find target "+zs);}else{zr.style.display=(zr.style.display=="none")?'':'none';return false;}}function o(zt,zr){var zs=ge(zt);if(!zs){return x("Could not find target "+zt);}else{zs.style.display=zr;return false;}}function l(zr){return n(zr,'');}function k(zr){return n(zr,'disabled');}function n(zt,zr){var zs=ge(zt);if(!zs){return x("Could not find target "+zt);}else{zs.disabled=zr;return false;}}function e(zs,zr){var zt;for(zt=zs.childNodes.length-1;zt>=0;zt--)if(zs.childNodes[zt].name&&zs.childNodes[zt].name.indexOf('fb_sig')==0)zs.removeChild(zs.childNodes[zt]);for(keyVar in zr)DOM.appendContent(zs,$N('input',{name:keyVar,value:zr[keyVar],type:'hidden'}));}function zb(zr,zu,zs){var zv=function(zw){Arbiter.subscribe('PLATFORM_HAS_SESSION_DATA',function(event,zx){zs(zx.session.uid);});};var zt=bagofholding;d(zr,{perms:zu},zv,zt);}function zk(zr,zx,zs,zu,zy,zv){var zz=zs;var zt=zs;if(zv!=null)zz=function(zza){DOM.appendContent(zv,$N('input',{name:'fb_perms_approved',value:'1',type:'hidden'}));zs.apply(this,arguments);}.bind(this);var zw={perms:zx};if(zu)zw.enable_profile_selector=1;if(zy!=null){zw.enable_profile_selector=1;zw.profile_selector_ids=zy;}d(zr,zw,zz,zt);}function d(zr,zw,zv,zu){var zt=function(zy){var zz=zy&&(zy.installed||zy.perms||zy.session);if(zz&&zw&&zw.perms)zz=v(zw.perms,zy.perms);if(zz){this._hasGrantedPerms=true;zv(zy.perms);}else if(zu)zu(null);}.bind(this);var zx=function(){this.loginDialog=zm(zr,'permissions.request',zw,zt,600);}.bind(this);if(zw.perms){zx();}else if(!this._hasGrantedPerms){var zs=function(event,zy){Arbiter.unsubscribe(this._arbiterSessionSubscription);if(zy.session.session_key){zv(null);}else zx();};this._arbiterSessionSubscription=Arbiter.subscribe('PLATFORM_HAS_SESSION_DATA',function(event,zy){zs.bind(this,event,zy).defer();});}}function v(zu,zr){var zv=true;var zu=zu.split(',');var zr=zr.split(',');for(var zs=0;zs<zu.length;zs++){zv=false;for(var zt=0;zt<zr.length;zt++)if(zu[zs].trim()==zr[zt].trim()){zv=true;break;}if(!zv)break;}return zv;}function za(zr){return this.uiServerDialogs[zr];}function zi(zr,zs,zt){zm(zr,'bookmark.add',{},zs);}function zl(zr,zs){zm(zr,'profile.addTab',{},zs);}function zh(zr,zt,zs){zm(zr,'friends.add',{id:zt},zs);}function u(zr,zs){b(function(){FB.Connect.createApplication(zr,zs);});}function zn(zt,zy,zu,zr,zx,zz,zw,zv,zs){zm(zt,'stream.publish',{actor_id:zs,target_id:zx,attachment:zu,action_links:zr,message:zy,user_message_prompt:zz},function(zza){if(zza&&zza.post_id){zw(zza.post_id,null,{user_message:zza.message});}else zw(null,null,null);});}function zm(zr,zx,zy,zu,zza){var zt={app_id:zr};for(var zw in zt)if(zt.hasOwnProperty(zw))zy[zw]=zt[zw];for(zw in zy)if(zy[zw] instanceof Object||zy[zw] instanceof Array)zy[zw]=JSON.stringify(zy[zw]);var zz='/fbml/ajax/dialog/'+zx;var zs=new AsyncRequest().setURI(zz).setData(zy).setReadOnly(true);if(ua.ie()){zs.setMethod('POST');}else zs.setMethod('GET');var zv=new Dialog().setAsync(zs).setModal(true).setStackable(true).setCloseHandler(zu);if(zza)zv.setContentWidth(zza);zv.show();return zv;}function b(zr){Arbiter.subscribe('PLATFORM_HAS_SESSION_DATA',function(event,zs){FB.init({apiKey:zs.api_key,disableCookies:true,xdChannelUrl:"/xd_receiver_v0.4.php"});FB.ensureInit(function(){FB.Facebook.apiClient.set_session(zs.session);zr();});});}function zj(zr,zx,zy,zs,zw,zt,zza,zz){var zu={template_id:zx,template_data:zy,body_general:zs};var zv;if(zw&&(!hasArrayNature(zw)||zw.length>0)){if(hasArrayNature(zw))zw=zw[0];zv=new TargetFeedForm().setTarget(zw);}else zv=new FeedForm();zv.setContinuation(zt).setFeedData(zu).setAppId(zr).setUserMessagePrompt(zza).setUserMessage(zz).show();}function t(){if(this.loginDialog){var zr=this.loginDialog;this.loginDialog=null;zr.close();}}function zg(zr,zt,zs,zu){d(zr,{},zt,zs,zu);}function i(zs){var zr=Dialog.getCurrent();zr&&zr.hide();}function zd(zs){var zu=$('sp'+zs);var zt=zu.parentNode;zt.removeChild(zu);for(var zr=0;zr<zt.childNodes.length;zr++)if(zt.childNodes[zr].nodeName=='SPAN')return false;i(zt);return false;}function zf(zs,zv,zu){var zt=zv.getElementsByTagName('input');for(var zr=0;zr<zt.length;zr++)if(((zt[zr].name=='emails[]')||(zt[zr].name=='ids[]'))&&(zt[zr].value==zs)){delNode=zt[zr].parentNode.parentNode.parentNode.parentNode.parentNode.token;if(delNode)delNode.remove(false);}zd(zs);return false;}function ze(zv,zu,zt){if(zt){if(fs.selected_ids[zv]){fs.unselect(zv);fs.force_reset();}else{zf(zv,zu,zt);return false;}}else{var zs=zu.getElementsByTagName('input');for(var zr=0;zr<zs.length;zr++)if(zs[zr].getAttribute('fb_protected')=='true'&&zs[zr].value==zv)if(zs[zr].name=='ids[]'){if(zs[zr].type=='checkbox'){if(zs[zr].checked)zs[zr].click();}else zs[zr].parentNode.parentNode.parentNode.parentNode.parentNode.token.remove(true);}else if(zs[zr].name=='friend_selector_id'){zs[zr].typeahead.select_suggestion(false);zs[zr].typeahead.set_value('');zs[zr].value='';}}zd(zv);return false;}var zo=function(zr){var zu=zr.getElementsByTagName('a');for(var zt=0;zt<zu.length;zt++)if(!zu[zt].getAttribute('flash'))Event.listen(zu[zt],'click',Event.kill);var zs=zr.getElementsByTagName('form');for(var zt=0;zt<zs.length;zt++)zs[zt].onsubmit=function(){return false;};};var w=function(zr,zs){for(styleName in zs)zr.style[styleName]=zs[styleName];};var zc=function(zr,zs){var zt=fbjs_sandbox.getSandbox(zr);if(zt)zt.setBridgeHash(zs);};var zp=function(zs,event){if(zs.onsubmit)try{if(!zs.onsubmit(event))return;}catch(zr){if(zr.message=="Object doesn't support this action"){if(!zs.onsubmit())return;}else throw zr;}zs.submit();};return {friendSelector:y,Contexts:a,attachCurlFromObject:g,attachFromPreview:h,clickRewriteAjax:j,clickToShow:p,clickToShowDialog:q,clickToHide:m,clickToEnable:l,clickToDisable:k,clickToToggle:r,closeDialogInvoked:s,createApplication:u,removeTokenizerRecipient:zf,removeReqRecipient:ze,cancelDialog:i,addHiddenInputs:e,requireLogin:zg,closeLoginDialog:t,showFeedDialog:zj,streamPublish:zn,promptPermissionPro:zb,showPermissionDialog:zk,isUIServerEnabled:za,showBookmarkDialog:zi,showProfileTabDialog:zl,showAddFriendDialog:zh,stripLinks:zo,enforceStyle:w,registerFBJSBridge:zc,submitForm:zp};})();Arbiter.subscribe('PLATFORM_UI_SERVER_DIALOGS',function(event,a){FBML.uiServerDialogs=a;});
PlatformCanvasResponse={pollPageInfo:function(b,a,c){a.channelUrl=c.channelUrl;a.info={};if(a.polling)return;a.polling=true;a.timestamp=0;a.minTimeout=1000;(function(){var i=new Date().getTime();if(i-a.timestamp<a.minTimeout)return;var f={};var d=Vector2.getViewportDimensions();f.clientWidth=d.x;f.clientHeight=d.y;var h=Vector2.getScrollPosition();f.scrollLeft=h.x;f.scrollTop=h.y;var e=b;f.offsetLeft=0;f.offsetTop=0;while(e){f.offsetLeft+=parseInt(e.offsetLeft,10);f.offsetTop+=parseInt(e.offsetTop,10);e=e.offsetParent;}if(a.info.scrollLeft===f.scrollLeft&&a.info.scrollTop===f.scrollTop&&a.info.clientWidth===f.clientWidth&&a.info.clientHeight===f.clientHeight&&a.info.offsetLeft===f.offsetLeft&&a.info.offsetTop===f.offsetTop)return;a.info=f;var g={type:'pageInfo.update',clientWidth:a.info.clientWidth,clientHeight:a.info.clientHeight,scrollLeft:a.info.scrollLeft,scrollTop:a.info.scrollTop,offsetLeft:a.info.offsetLeft,offsetTop:a.info.offsetTop};XD.send(g,a.channelUrl);a.timestamp=i;}).recur(c.updateInterval);}};
function PlatformCanvasController(b,h,j,i,c,e,a,l,k,d,f){var g=PlatformCanvasController.singleton;if(g){g.initApplication(b,h,j,i,c,e,a,true,f);return g;}PlatformCanvasController.singleton=this;this.uid=l;this.appTransitionsEnabled=d;this._movingPage=false;this._content=$('content');this.lastRefreshAd=+new Date();this.initApplication(b,h,j,i,c,e,a,false);Arbiter.inform('PLATFORM_UI_SERVER_DIALOGS',k,Arbiter.BEHAVIOR_PERSISTENT);PageTransitions.registerHandler(this.handlePageTransition.bind(this));}PlatformCanvasController.prototype={getFrameName:function(){return location.protocol==='https:'?'iframe_canvas_fb_https':'iframe_canvas';},initApplication:function(b,h,j,i,c,d,a,g,f){var e=(this.appId==null);this.appId=b;this.sessionKey=h;this.appName=c;this.callback=d;this.isIframe=f;this.sessionRefresh=(j*900);if(b&&h&&j)setTimeout(this.refreshAppSession.bind(this),this.sessionRefresh);Arbiter.inform('PLATFORM_HAS_SESSION_DATA',{api_key:a,session:{session_key:h,uid:this.uid,expires:j,secret:i}},Arbiter.BEHAVIOR_PERSISTENT);if(g&&!e)this.refreshAd();},_autoRefresh:240000,_refreshAfterUserActivity:5000,autoRefreshAd:function(a,b){this._autoRefresh=a;this._refreshAfterUserActivity=b;if(this.isIFrame)$(this.getFrameName()).onload=this.refreshAd.bind(this);UserActivity.subscribe(function(){var c=+new Date();if(c-this.lastRefreshAd>=this._autoRefresh-this._refreshAfterUserActivity){setTimeout(this.refreshAd.bind(this),this._refreshAfterUserActivity);this.lastRefreshAd=c+this._refreshAfterUserActivity;}}.bind(this));},requireLogin:function(){var a=FB.IFrameUtil.CanvasUtilServer.loginResponse;FBML.requireLogin(this.appId,a.bind(null,true),a.bind(null,false),null,true,true);},closeLogin:function(){FBML.closeLoginDialog();},showFeedDialog:function(c,d,a,b,f,e){FBML.showFeedDialog(this.appId,c,d,a,b,FB.IFrameUtil.CanvasUtilServer.loginResponse.bind(null),f,e);},refreshAppSession:function(){new AsyncRequest().setURI('/ajax/session.php').setData({app_id:this.appId,session_key:this.sessionKey}).setReadOnly(true).setHandler(function(b){var a=b.getPayload();if(a.session_end>0)setTimeout(this.refreshAppSession.bind(this),this.sessionRefresh);}.bind(this)).send();},changeUrlSuffix:function(c,a){this.currentUri=URI.getRequestURI().getUnqualifiedURI();var b=new URI(this.getAppPrefix()+c);this.stripFbParams(b);if(this.currentUri.toString()!=b.toString()){this.currentUri=b;this.refreshAd();PageTransitions.go(b.toString(),a&&ua.ie());}},getAppPrefix:function(){return "/"+this.appName+"/";},stripFbParams:function(d){var c=d.getQueryData(),b={};for(var a in c)if((!a.startsWith("fb_")||a.startsWith("fb_force_mode"))&&!a.startsWith("_fb")&&!a.startsWith("quickling_apps"))b[a]=c[a];d.setQueryData(b);},refreshAd:function(){ads_refresh(this.appName,'/canvas.php',null,false,0,this.appId);},handlePageTransition:function(a){return this.handleIFrameChange(a)||this.handleApplicationChange(a)||false;},_activeNav:null,handleApplicationChange:function(k){if(!this.appTransitionsEnabled)return false;if(this._movingPage||k.getSubdomain()!='apps')return false;var f=DOM.scry(DOM.find(this._content,'div.canvasSidebar'),'a'),e=f.length,d=false;for(var c=0;c<e;c++)if(f[c].href==k){d=true;break;}if(!d)return false;DOM.empty(DOM.find(this._content,'div.UIStandardFrame_Content'));var a='',g='',h=k.getPath().split('/'),i=$('canvas_throbber_text'),j=k.getUnqualifiedURI();this.stripFbParams(j);if(h.length)a=h[1];var b=DOM.scry(document,'div.canvasSidebar .uiSideNav a.item');for(var c=0;c<b.length;c++)if(b[c].href==k){this._activeNav=b[c].parentNode;break;}if(this._activeNav)g=DOM.getText(DOM.find(this._activeNav,'span.linkWrap'));DOM.setContent(i,_tx("Loading {app-name}",{'app-name':g}));new AsyncRequest().setURI(new URI('/ajax/canvas.php')).setData({fb_app_name:a,uri:j.toString()}).setMethod('GET').setReadOnly(true).setStatusElement('canvas_throbber').setHandler(this.completeApplicationChange.bind(this)).send();return true;},completeApplicationChange:function(g){var e=g.getPayload(),a=DOM.find(this._content,'div.footer'),d=DOM.find(this._content,'div.canvasSidebar'),b=DOM.find(this._content,'div.UIStandardFrame_Content');DOM.setContent(b,HTML(e.main_html));if(d){CSS.show(DOM.find(d,'li.hidden_elem'));CSS.hide($('navItem_app_'+e.app_id));}if(a){var c=$('brand_info'),f=$('report_link');c.innerHTML=e.app_name;c.href=e.about_link;f.href='/ajax/report_app.php?app_id='+e.app_id;f.title=_tx("Report problems with {app-name}",{'app-name':e.app_name});}this._activeNav=null;PageTransitions.transitionComplete();},handleIFrameChange:function(d){if(!this.isIFrame)return false;if(!d.getPath().startsWith("/"+this.appName)||this._movingPage)return false;var c=d.getUnqualifiedURI();this.stripFbParams(c);if(this.currentUri.toString()!=c.toString()){var a=this.getAppPrefix();var b=c.toString().substring(a.length);FB.IFrameUtil.CanvasUtilServer.loadNewUrl(new URI(this.callback+b).toString());this.currentUri=c;}PageTransitions.transitionComplete();return true;},goURI:function(a){this._movingPage=true;PageTransitions.go(new URI(a));},eachIframe:function(b){if(typeof b!='function')return;var a=document.getElementsByTagName('iframe');for(var c=0;c<a.length;c++)b(a[c],c);},refreshUrl:function(c){var a=c.href;if(a.startsWith(this.callback)){var b=new URI(a.substring(this.callback.length));this.changeUrlSuffix(b,true);}return false;}};var CanvasResizer={_resizeListener:null,_smartIframes:[],_width:758,smartSizingFrameAdded:function(){this._resizeListener=Event.listen(window,'resize',this._resizeSmartFrames);this._smartIframes=[];PlatformCanvasController.prototype.eachIframe(function(a,b){if(CSS.hasClass(a,'smart_sizing_iframe')&&!CSS.hasClass(a,'noresize')){CSS.removeClass(a,'canvas_iframe_util');this._smartIframes.push(a);a.style.width=this._width+"px";}}.bind(this));this._resizeSmartFrames();},_resizeSmartFrames:function(){var b,a=document.documentElement;if(window.innerHeight){b=window.innerHeight;}else if(a&&a.clientHeight){b=a.clientHeight;}else b=document.body.clientHeight;for(var c=0;c<this._smartIframes.length;c++)if(!CSS.hasClass(this._smartIframes[c],'noresize')){var d=b-elementY(this._smartIframes[c])-61;this._smartIframes[c].style.height=d/(this._smartIframes.length-c)+'px';}}};Arbiter.subscribe('Connect.Unsafe.setSize',function(c,b){var a=PlatformCanvasController.prototype.getFrameName();if(b.frame&&b.frame!=a)return;PlatformCanvasController.prototype.eachIframe(function(d,f){if(d.name!=a)return;var e=parseInt(b.height,10);d.style.height=e+'px';d.style.overflowY='hidden';CSS.addClass(d,'noresize');});});Arbiter.subscribe('Connect.Unsafe.scrollTo',function(b,a){var c=parseInt(a.x,10),d=parseInt(a.y,10);if(c>=0&&d>=0)window.scrollTo(c,d);});(function CanvasPageInfoPoller(){var a={};Arbiter.subscribe('Connect.Unsafe.pollPageInfo',function(d,c){var b=PlatformCanvasController.prototype.getFrameName();PlatformCanvasController.prototype.eachIframe(function(e,f){if(e.name!=b)return;PlatformCanvasResponse.pollPageInfo(e,a,c);});});})();
if(Object.prototype.eval)window.eval=Object.prototype.eval;delete Object.prototype.eval;delete Object.prototype.valueOf;function fbjs_sandbox(a){if(fbjs_sandbox.instances['a'+a])return fbjs_sandbox.instances['a'+a];this.appid=a;this.pending_bootstraps=[];this.bootstrapped=false;fbjs_sandbox.instances['a'+a]=this;}fbjs_sandbox.instances={};fbjs_sandbox.prototype.bootstrap=function(){if(!this.bootstrapped){var appid=this.appid;var code=['a',appid,'_Math = new fbjs_math();','a',appid,'_Date = fbjs_date();','a',appid,'_String = new fbjs_string();','a',appid,'_RegExp = new fbjs_regexp();','a',appid,'_Ajax = fbjs_ajax(',appid,');','a',appid,'_Dialog = fbjs_dialog(',appid,');','a',appid,'_Facebook = new fbjs_facebook(',appid,');','a',appid,'_Animation = new fbjs_animation();','a',appid,'_LiveMessage = new fbjs_livemessage(',appid,');','a',appid,'_document = new fbjs_main(',appid,');','a',appid,'_undefined = undefined;','a',appid,'_console = new fbjs_console();','a',appid,'_setTimeout = fbjs_sandbox.set_timeout;','a',appid,'_setInterval = fbjs_sandbox.set_interval;','a',appid,'_escape = encodeURIComponent;','a',appid,'_unescape = decodeURIComponent;'];for(var i in {clearTimeout:1,clearInterval:1,parseFloat:1,parseInt:1,isNaN:1,isFinite:1})code=code.concat(['a',appid,'_',i,'=',i,';']);eval(code.join(''));}try{for(var i=0,il=this.pending_bootstraps.length;i<il;i++)eval_global(this.pending_bootstraps[i]);}finally{fbjs_sandbox.clean_mess();}this.pending_bootstraps=[];this.bootstrapped=true;};fbjs_sandbox.prototype.setBridgeHash=function(a){this.bridgeHash=a;return this;};fbjs_sandbox.getSandbox=function(a){return fbjs_sandbox.instances['a'+a];};fbjs_sandbox.loadScripts=function(a){script=a.shift(0);if(!script)return false;if(script.inline){eval_global(script.inline);fbjs_sandbox.loadScripts(a);}else loadExternalJavascript(script.src,fbjs_sandbox.loadScripts.bind(null,a));};var $FBJS=(function(){function d(e){if(e==window){return null;}else if(e.ownerDocument===document){fbjs_console.error('ref called with a DOM object!');return fbjs_dom.get_instance(e);}else{if(ua.safari()<528.16&&(typeof e=='object')&&!(e instanceof Object))return null;return e;}}function c(e){return (e instanceof Object||b[e])?'__unknown__':e;}var b={caller:true,__html:true,$FBJS:true};function a(e){var g=[];for(var f=0;f<e.length;f++)g.push(e[f]);return g;}return ({arg:a,idx:c,ref:d});})();(function(){var a=String.prototype.replace,b=String.prototype.toLowerCase;fbjs_sandbox.safe_string=function(c){String.prototype.replace=a;String.prototype.toLowerCase=b;return c+'';};})();fbjs_sandbox.clean_mess=function(){delete Function.prototype.bind.call;delete Function.prototype.bind.apply;};fbjs_sandbox.set_timeout=function(a,b){if(typeof a!='function'){fbjs_console.error('setTimeout may not be used with a string. Please enclose your event in an anonymous function.');}else return setTimeout(function(){try{a();}finally{fbjs_sandbox.clean_mess();}},b);};fbjs_sandbox.set_interval=function(b,a){if(typeof b!='function'){fbjs_console.error('setInterval may not be used with a string. Please enclose your event in an anonymous function.');}else return setInterval(function(){try{b();}finally{fbjs_sandbox.clean_mess();}},a);};function fbjs_main(a){fbjs_private.get(this).appid=a;}fbjs_main.allowed_elements={a:true,abbr:true,acronym:true,address:true,b:true,br:true,bdo:true,big:true,blockquote:true,caption:true,center:true,cite:true,code:true,del:true,dfn:true,div:true,dl:true,dd:true,dt:true,em:true,fieldset:true,font:true,form:true,h1:true,h2:true,h3:true,h4:true,h5:true,h6:true,hr:true,i:true,img:true,input:true,ins:true,iframe:true,kbd:true,label:true,legend:true,li:true,ol:true,option:true,optgroup:true,p:true,pre:true,q:true,s:true,samp:true,select:true,small:true,span:true,strike:true,strong:true,sub:true,sup:true,table:true,textarea:true,tbody:true,td:true,tfoot:true,th:true,thead:true,tr:true,tt:true,u:true,ul:true,'fb:swf':true};fbjs_main.allowed_editable={embed:true,object:true};fbjs_main.allowed_events={focus:true,click:true,mousedown:true,mouseup:true,dblclick:true,change:true,reset:true,select:true,submit:true,keydown:true,keypress:true,keyup:true,blur:true,load:true,mouseover:true,mouseout:true,mousemove:true,selectstart:true};fbjs_main.prototype.getElementById=function(b){var a=fbjs_private.get(this).appid;return fbjs_dom.get_instance(document.getElementById('app'+a+'_'+b),a);};fbjs_main.prototype.getRootElement=function(){var a=fbjs_private.get(this).appid;var d=document.getElementById('app_content_'+a).childNodes;for(var b in d){var c=d[b];if(c.nodeType==1)return fbjs_dom.get_instance(c,a);}};fbjs_main.prototype.createElement=function(a){var b=fbjs_sandbox.safe_string(a.toLowerCase());if(!fbjs_main.allowed_elements[b]){fbjs_console.error(b+' is not an allowed DOM element');return;}if(b=='fb:swf')return new fbjs_fbml_dom('fb:swf',fbjs_private.get(this).appid);return fbjs_dom.get_instance(document.createElement(b),fbjs_private.get(this).appid);};fbjs_main.prototype.setLocation=function(a){a=fbjs_sandbox.safe_string(a);if(fbjs_dom.href_regex.test(a)){document.location.href=a;return this===window?null:this;}else fbjs_console.error(a+' is not a valid location');};function fbjs_facebook(a){var b=fbjs_private.get(this);b.appid=a;b.sandbox=fbjs_sandbox.instances['a'+a];this.appid=a;}fbjs_facebook.prototype.getUser=function(){var a=fbjs_private.get(this);if(a.sandbox.data.installed){return a.sandbox.data.user;}else return null;};fbjs_facebook.prototype.isApplicationAdded=function(){return fbjs_private.get(this).sandbox.data.installed;};fbjs_facebook.prototype.isLoggedIn=function(){return fbjs_private.get(this).sandbox.data.installed;};fbjs_facebook.prototype.trackPageview=function(a){if(_gaq){_gaq.push(["_trackPageview",a]);}else fbjs_console.error('There is no fb:google-analytics tag on this page!');};fbjs_facebook.prototype.urchinTracker=fbjs_facebook.prototype.trackPageview;fbjs_facebook.prototype.trackEvent=function(b,a,c,d){if(_gaq){_gaq.push(["_trackEvent",b,a,c,d]);}else fbjs_console.error('There is no fb:google-analytics tag on this page!');};fbjs_facebook.prototype.showFeedDialog=function(d,e,a,c,b,g,f){FBML.showFeedDialog(this.appid,d,e,a,c,b,g,f);};fbjs_facebook.prototype.streamPublish=function(g,c,a,f,h,e,d,b){FBML.streamPublish(this.appid,g,c,a,f,h,e,d,b);};fbjs_facebook.prototype.promptPermission=function(b,a){FBML.promptPermissionPro(this.appid,b,a);};fbjs_facebook.prototype.showPermissionDialog=function(c,a,b,d){FBML.showPermissionDialog(this.appid,c,a,b,d);};fbjs_facebook.prototype.showBookmarkDialog=function(a,b){FBML.showBookmarkDialog(this.appid,a,b);};fbjs_facebook.prototype.showProfileTabDialog=function(a){FBML.showProfileTabDialog(this.appid,a);};fbjs_facebook.prototype.showAddFriendDialog=function(b,a){FBML.showAddFriendDialog(this.appid,b,a);};fbjs_facebook.prototype.createApplication=function(a,b){FBML.createApplication(a,b);};fbjs_facebook.prototype.setPublishStatus=function(c){var d=ge(this.appid+'_publish_button');if(d){d.disabled=!c;CSS.conditionClass(d,'disabled_button',!c);}var b=ge('app_content_'+this.appid);if(b){var a=DataStore.get(b,'attachment');if(a)a.setEnabled(c);}};fbjs_facebook.prototype.requireLogin=function(b,a){if(!b){fbjs_console.error('Continuation is a required parameter for requireLogin');return false;}var c=fbjs_private.get(this);if(!c.sandbox.data.installed){FBML.requireLogin(this.appid,function(){c.sandbox.data.installed=true;try{b();}finally{fbjs_sandbox.clean_mess();}},(a||bagofholding));}else try{b();}finally{fbjs_sandbox.clean_mess();}};fbjs_facebook.prototype.submitOrder=function(e){var a=fbjs_private.get(this).appid;var g=e.receiver;var f=e.order_info;var c=e.next_js;var d=e.next_url;var j={cc:'',mobile:'',paypal_ba:'',offer:''};if(e.shortcut in j){var h=e.shortcut;}else var h=null;var b={oscif:e.oscif,shortcut:h};GiftCredits.getPrompt(a,g,f,d,c,GiftCredits.PLACE_APP,null,null,false,b);};function fbjs_dom(c,a){this.__instance=fbjs_dom.len;try{c.fbjs_instance=fbjs_dom.len;}catch(b){}fbjs_dom[fbjs_dom.len]={instance:this,obj:c,events:{},appid:a};fbjs_dom.len++;}fbjs_dom.len=0;fbjs_dom.attr_setters={href:'setHref',id:'setId',dir:'setDir',checked:'setChecked',action:'setAction',value:'setValue',method:'setMethod',target:'setTarget',src:'setSrc','class':'setClassName',dir:'setDir',title:'setTitle',tabIndex:'setTabIndex',name:'setName',cols:'setCols',rows:'setRows',accessKey:'setAccessKey',disabled:'setDisabled',readOnly:'setReadOnly',type:'setType',selectedIndex:'setSelectedIndex',selected:'setSelected'};fbjs_dom.factory=function(b,a){if(!b.tagName||((!fbjs_main.allowed_elements[b.tagName.toLowerCase()]&&!fbjs_main.allowed_editable[b.tagName.toLowerCase()])||CSS.hasClass(b,'__fbml_tag')||b.id==='so_swf_fbjs'||(b.tagName=='INPUT'&&(b.name.substring(0,2)=='fb'||b.name=='post_form_id'))||b.getAttribute('fb_protected')=='true')){return null;}else return new this(b,a);};fbjs_dom.get_data=function(b){if(b.__instance instanceof Object){return null;}else{var a=fbjs_dom[b.__instance];return a.instance==b?a:null;}};fbjs_dom.get_obj=function(b){if(b instanceof fbjs_fbml_dom){return fbjs_fbml_dom.get_obj(b);}else if(typeof b.__instance=='number'){var a=fbjs_dom[b.__instance];if(a&&a.instance==b){return a.obj;}else throw ('This DOM node is no longer valid.');}else throw ('This DOM node is no longer valid.');};fbjs_dom.render=function(a){if(a instanceof fbjs_fbml_dom)fbjs_fbml_dom.render(a);};fbjs_dom.get_instance=function(b,a){if(!b)return null;if(typeof b.fbjs_instance=='undefined'){return fbjs_dom.factory(b,a);}else return fbjs_dom[b.fbjs_instance].instance;};fbjs_dom.get_instance_list=function(c,a){var e=[];for(var b=0;b<c.length;b++){var d=fbjs_dom.get_instance(c[b],a);if(d)e.push(d);}return e;};fbjs_dom.get_first_valid_instance=function(c,b,a){var d=null;if(c&&((c.id&&c.id.indexOf('app_content')!=-1)||(c.tagName&&c.tagName.toLowerCase()=='body')))return null;while(c&&(!(d=fbjs_dom.factory(c,a)))){if((c.id&&c.id.indexOf('app_content')!=-1)||(c.tagName&&c.tagName.toLowerCase()=='body'))return null;c=c[b];}return d;};fbjs_dom.clear_instances=function(d,c){if(c&&d.fbjs_instance){delete fbjs_dom[d.fbjs_instance].obj;delete fbjs_dom[d.fbjs_instance].events;delete fbjs_dom[d.fbjs_instance].instance;delete fbjs_dom[d.fbjs_instance];d.fbjs_instance=undefined;}var a=d.childNodes;for(var b=0;b<a.length;b++)fbjs_dom.clear_instances(a[b],true);};fbjs_dom.prototype.appendChild=function(a){fbjs_dom.get_obj(this).appendChild(fbjs_dom.get_obj(a));fbjs_dom.render(a);return a;};fbjs_dom.prototype.insertBefore=function(b,a){if(a){fbjs_dom.get_obj(this).insertBefore(fbjs_dom.get_obj(b),fbjs_dom.get_obj(a));}else fbjs_dom.get_obj(this).appendChild(fbjs_dom.get_obj(b));fbjs_dom.render(b);return b;};fbjs_dom.prototype.removeChild=function(a){var a=fbjs_dom.get_obj(a);fbjs_dom.clear_instances(a,true);fbjs_dom.get_obj(this).removeChild(a);return this;};fbjs_dom.prototype.replaceChild=function(a,b){fbjs_dom.clear_instances(b,true);fbjs_dom.get_obj(this).replaceChild(fbjs_dom.get_obj(a),fbjs_dom.get_obj(b));return this;};fbjs_dom.prototype.cloneNode=function(c){var a=fbjs_dom.get_data(this);var b=a.obj.cloneNode(c);b.fbjs_instance=undefined;return fbjs_dom.get_instance(b,a.appid);};fbjs_dom.prototype.getParentNode=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_first_valid_instance(a.obj.parentNode,'parentNode',a.appid);};fbjs_dom.prototype.getNextSibling=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_first_valid_instance(a.obj.nextSibling,'nextSibling',a.appid);};fbjs_dom.prototype.getPreviousSibling=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_first_valid_instance(a.obj.previousSibling,'previousSibling',a.appid);};fbjs_dom.prototype.getFirstChild=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_first_valid_instance(a.obj.firstChild,'nextSibling',a.appid);};fbjs_dom.prototype.getLastChild=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_first_valid_instance(a.obj.lastChild,'previousSibling',a.appid);};fbjs_dom.prototype.getChildNodes=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_instance_list(a.obj.childNodes,a.appid);};fbjs_dom.prototype.getElementsByTagName=function(b){var a=fbjs_dom.get_data(this);return fbjs_dom.get_instance_list(a.obj.getElementsByTagName(b),a.appid);};fbjs_dom.prototype.getOptions=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_instance_list(a.obj.options,a.appid);};fbjs_dom.prototype.getForm=function(){var a=fbjs_dom.get_data(this);return fbjs_dom.get_instance(a.obj.form,a.appid);};fbjs_dom.prototype.serialize=function(){var b=fbjs_dom.get_data(this).obj.elements;var a={};for(var c=b.length-1;c>=0;c--)if(b[c].name&&b[c].name.substring(0,2)!='fb'&&b[c].name!='post_form_id'&&!b[c].disabled)if(b[c].tagName=='SELECT'){var f=b[c].multiple?b[c].name+'[]':b[c].name;for(var d=0,e=b[c].options.length;d<e;d++)if(b[c].options[d].selected)Form._serializeHelper(a,f,(b[c].options[d].getAttribute('value')==null)?undefined:b[c].options[d].value);}else if(!(b[c].type=='radio'||b[c].type=='checkbox')||b[c].checked||(!b[c].type||b[c].type=='text'||b[c].type=='password'||b[c].type=='hidden'||b[c].tagName=='TEXTAREA'))Form._serializeHelper(a,b[c].name,b[c].value);return a;};fbjs_dom.prototype.setInnerXHTML=function(b){var a=fbjs_dom.get_data(this);var e=new fbjs_fbml_sanitize(a.appid);var c=e.parseFBML(b);if(!c)return this;var d=fbjs_dom.get_obj(this);switch(d.tagName){case 'TEXTAREA':fbjs_console.error('setInnerXHTML is not supported on textareas. Please use .value instead.');break;case 'COL':case 'COLGROUP':case 'TABLE':case 'TBODY':case 'TFOOT':case 'THEAD':case 'TR':fbjs_console.error('setInnerXHTML is not supported on this node.');break;default:fbjs_dom.clear_instances(d,false);DOM.empty(d);this.appendChild(c);break;}return this;};fbjs_dom.prototype.setInnerFBML=function(a){var b=fbjs_private.get(a).htmlstring;var c=fbjs_dom.get_obj(this);switch(c.tagName){case 'TEXTAREA':fbjs_console.error('setInnerFBML is not supported on textareas. Please use .value instead.');break;case 'COL':case 'COLGROUP':case 'TABLE':case 'TBODY':case 'TFOOT':case 'THEAD':case 'TR':fbjs_console.error('setInnerFBML is not supported on this node.');break;default:DOM.setContent(c,b);break;}return this;};fbjs_dom.prototype.setTextValue=function(b){var a=fbjs_dom.get_obj(this);fbjs_dom.clear_instances(a,false);DOM.setContent(a,fbjs_sandbox.safe_string(b));return this;};fbjs_dom.prototype.setValue=function(a){fbjs_dom.get_obj(this).value=a;return this;};fbjs_dom.prototype.getValue=function(){var a=fbjs_dom.get_obj(this);if(a.tagName=='SELECT'){var b=a.selectedIndex;if(b==-1){return null;}else if(a.options[b].getAttribute('value')==null){return undefined;}else return a.value;}else return fbjs_dom.get_obj(this).value;};fbjs_dom.prototype.getSelectedIndex=function(){return fbjs_dom.get_obj(this).selectedIndex;};fbjs_dom.prototype.setSelectedIndex=function(a){fbjs_dom.get_obj(this).selectedIndex=a;return this;};fbjs_dom.prototype.getChecked=function(){return fbjs_dom.get_obj(this).checked;};fbjs_dom.prototype.setChecked=function(a){fbjs_dom.get_obj(this).checked=a;return this;};fbjs_dom.prototype.getSelected=function(){return fbjs_dom.get_obj(this).selected;};fbjs_dom.prototype.setSelected=function(a){fbjs_dom.get_obj(this).selected=a;return this;};fbjs_dom.set_style=function(b,c,d){if(typeof c=='string'){if(c=='opacity'){CSS.setStyle(b,'opacity',parseFloat(d,10));}else{d=fbjs_sandbox.safe_string(d);if(fbjs_dom.css_regex.test(d)){b.style[c]=d;}else fbjs_console.error(c+': '+d+' is not a valid CSS style');}}else for(var a in c)fbjs_dom.set_style(b,a,c[a]);};fbjs_dom.css_regex=/^(?:[\w\-#%+]+|rgb\(\d+ *, *\d+, *\d+\)|url\('?http[^ ]+?'?\)| +)*$/i;fbjs_dom.prototype.setStyle=function(a,b){fbjs_dom.set_style(fbjs_dom.get_obj(this),a,b);return this;};fbjs_dom.prototype.getStyle=function(a){return fbjs_dom.get_obj(this).style[$FBJS.idx(a)];};fbjs_dom.prototype.setHref=function(a){a=fbjs_sandbox.safe_string(a);if(fbjs_dom.href_regex.test(a)){fbjs_dom.get_obj(this).href=a;return this;}else fbjs_console.error(a+' is not a valid hyperlink');};fbjs_dom.href_regex=/^(?:https?|mailto|ftp|aim|irc|itms|gopher|\/|#)/;fbjs_dom.sanitizeUri=function(a){var c=new URI().parse(a);for(var b in c.getQueryData())if(b.startsWith("_fb"))c.removeQueryData(b);return c.toString();};fbjs_dom.prototype.getHref=function(){return fbjs_dom.sanitizeUri(fbjs_dom.get_obj(this).href);};fbjs_dom.prototype.setAction=function(a){a=fbjs_sandbox.safe_string(a);if(fbjs_dom.href_regex.test(a)){fbjs_dom.get_obj(this).action=a;return this;}else fbjs_console.error(a+' is not a valid hyperlink');};fbjs_dom.prototype.getAction=function(){return fbjs_dom.get_obj(this).action;};fbjs_dom.prototype.setMethod=function(a){a=fbjs_sandbox.safe_string(a);fbjs_dom.get_obj(this).method=a.toLowerCase()=='get'?'get':'post';return this;};fbjs_dom.prototype.getMethod=function(){return fbjs_dom.get_obj(this).method;};fbjs_dom.prototype.setSrc=function(a){a=fbjs_sandbox.safe_string(a);if(fbjs_dom.href_regex.test(a)){fbjs_dom.get_obj(this).src=a;return this;}else fbjs_console.error(a+' is not a valid hyperlink');};fbjs_dom.prototype.getSrc=function(){return fbjs_dom.get_obj(this).src;};fbjs_dom.prototype.setTarget=function(a){fbjs_dom.get_obj(this).target=a;return this;};fbjs_dom.prototype.getTarget=function(){return fbjs_dom.get_obj(this).target;};fbjs_dom.prototype.setClassName=function(a){fbjs_dom.get_obj(this).className=a;return this;};fbjs_dom.prototype.getClassName=function(){return fbjs_dom.get_obj(this).className;};fbjs_dom.prototype.hasClassName=function(a){return CSS.hasClass(fbjs_dom.get_obj(this),a);};fbjs_dom.prototype.addClassName=function(a){CSS.addClass(fbjs_dom.get_obj(this),a);return this;};fbjs_dom.prototype.removeClassName=function(a){CSS.removeClass(fbjs_dom.get_obj(this),a);return this;};fbjs_dom.prototype.toggleClassName=function(a){this.hasClassName(a)?this.removeClassName(a):this.addClassName(a);return $FBJS.ref(this);};fbjs_dom.prototype.getTagName=function(){return fbjs_dom.get_obj(this).tagName;};fbjs_dom.prototype.getNodeType=function(){return fbjs_dom.get_obj(this).nodeType;};fbjs_dom.prototype.getId=function(){var a=fbjs_dom.get_obj(this).id;if(a){return a.replace(/^app\d+_/,'');}else return a;};fbjs_dom.prototype.setId=function(b){var a=fbjs_dom.get_data(this);a.obj.id=['app',a.appid,'_',b].join('');return this;};fbjs_dom.prototype.setDir=function(a){fbjs_dom.get_obj(this).dir=a;return this;};fbjs_dom.prototype.getDir=function(a){return fbjs_dom.get_obj(this).dir;};fbjs_dom.prototype.getdir=function(a){return fbjs_dom.get_obj(this).dir;};fbjs_dom.prototype.getClientWidth=function(){return fbjs_dom.get_obj(this).clientWidth;};fbjs_dom.prototype.getClientHeight=function(){return fbjs_dom.get_obj(this).clientHeight;};fbjs_dom.prototype.getOffsetWidth=function(){return fbjs_dom.get_obj(this).offsetWidth;};fbjs_dom.prototype.getOffsetHeight=function(){return fbjs_dom.get_obj(this).offsetHeight;};fbjs_dom.prototype.getAbsoluteLeft=function(){return elementX(fbjs_dom.get_obj(this));};fbjs_dom.prototype.getAbsoluteTop=function(){return elementY(fbjs_dom.get_obj(this));};fbjs_dom.prototype.getScrollHeight=function(){return fbjs_dom.get_obj(this).scrollHeight;};fbjs_dom.prototype.getScrollWidth=function(a){return fbjs_dom.get_obj(this).scrollWidth;};fbjs_dom.prototype.getScrollTop=function(){return fbjs_dom.get_obj(this).scrollTop;};fbjs_dom.prototype.setScrollTop=function(a){fbjs_dom.get_obj(this).scrollTop=a;return this;};fbjs_dom.prototype.getScrollLeft=function(){return fbjs_dom.get_obj(this).scrollLeft;};fbjs_dom.prototype.setScrollLeft=function(a){fbjs_dom.get_obj(this).scrollLeft=a;return this;};fbjs_dom.prototype.getTabIndex=function(){return fbjs_dom.get_obj(this).tabIndex;};fbjs_dom.prototype.setTabIndex=function(a){fbjs_dom.get_obj(this).tabIndex=a;return this;};fbjs_dom.prototype.getTitle=function(){return fbjs_dom.get_obj(this).title;};fbjs_dom.prototype.setTitle=function(a){fbjs_dom.get_obj(this).title=a;return this;};fbjs_dom.prototype.getRowSpan=function(){return fbjs_dom.get_obj(this).rowSpan;};fbjs_dom.prototype.setRowSpan=function(a){fbjs_dom.get_obj(this).rowSpan=a;return this;};fbjs_dom.prototype.getColSpan=function(){return fbjs_dom.get_obj(this).colSpan;};fbjs_dom.prototype.setColSpan=function(a){fbjs_dom.get_obj(this).colSpan=a;return this;};fbjs_dom.prototype.getName=function(){return fbjs_dom.get_obj(this).name;};fbjs_dom.prototype.setName=function(a){fbjs_dom.get_obj(this).name=a;return this;};fbjs_dom.prototype.getCols=function(){return fbjs_dom.get_obj(this).cols;};fbjs_dom.prototype.setCols=function(a){fbjs_dom.get_obj(this).cols=a;return this;};fbjs_dom.prototype.getRows=function(){return fbjs_dom.get_obj(this).rows;};fbjs_dom.prototype.setRows=function(a){fbjs_dom.get_obj(this).rows=a;return this;};fbjs_dom.prototype.getAccessKey=function(){return fbjs_dom.get_obj(this).accessKey;};fbjs_dom.prototype.setAccessKey=function(a){fbjs_dom.get_obj(this).accessKey=a;return this;};fbjs_dom.prototype.setDisabled=function(a){fbjs_dom.get_obj(this).disabled=a;return this;};fbjs_dom.prototype.getDisabled=function(){return fbjs_dom.get_obj(this).disabled;};fbjs_dom.prototype.setMaxLength=function(a){fbjs_dom.get_obj(this).maxLength=a;return this;};fbjs_dom.prototype.getMaxLength=function(){return fbjs_dom.get_obj(this).maxLength;};fbjs_dom.prototype.setReadOnly=function(a){fbjs_dom.get_obj(this).readOnly=a;return this;};fbjs_dom.prototype.getReadOnly=function(){return fbjs_dom.get_obj(this).readOnly;};fbjs_dom.prototype.setType=function(a){a=fbjs_sandbox.safe_string(a);fbjs_dom.get_obj(this).type=a;return this;};fbjs_dom.prototype.getType=function(){return fbjs_dom.get_obj(this).type;};fbjs_dom.prototype.getSelection=function(){var a=fbjs_dom.get_obj(this);return FormControl.getCaretPosition(a);};fbjs_dom.prototype.setSelection=function(c,a){var b=fbjs_dom.get_obj(this);FormControl.setCaretPosition(b,c,a);return this;};fbjs_dom.prototype.submit=function(){fbjs_dom.get_obj(this).submit();return this;};fbjs_dom.prototype.focus=function(){fbjs_dom.get_obj(this).focus();return this;};fbjs_dom.prototype.select=function(){fbjs_dom.get_obj(this).select();return this;};fbjs_dom.eventHandler=function(event){var a=(event instanceof fbjs_event)?event:new fbjs_event(event?event:window.event,this[2]);if(a.ignore)return;try{var r=this[1].call(this[0],a);}finally{fbjs_sandbox.clean_mess();}if(r===false)a.preventDefault();return fbjs_event.destroy(a);};fbjs_dom.prototype.addEventListener=function(f,b){f=fbjs_sandbox.safe_string(f.toLowerCase());if(!fbjs_main.allowed_events[f]){fbjs_console.error(f+' is not an allowed event');return false;}var a=fbjs_dom.get_data(this);var e=a.obj;if(!a.events[f])a.events[f]=[];var c=null;var d=null;if(e.addEventListener){e.addEventListener(f,c=fbjs_dom.eventHandler.bind([this,b,a.appid]),false);}else if(e.attachEvent)e.attachEvent('on'+f,c=fbjs_dom.eventHandler.bind([this,b,a.appid]));a.events[f].push({func:b,handler:c,listener:d});return $FBJS.ref(this);};fbjs_dom.prototype.removeEventListener=function(f,b){f=f.toLowerCase();var a=fbjs_dom.get_data(this);var e=a.obj;if(a.events[f])for(var c=0,d=a.events[f].length;c<d;c++)if(a.events[f][c].func==b){if(e.removeEventListener){e.removeEventListener(f,a.events[f][c].handler,false);}else if(e.detachEvent)e.detachEvent('on'+f,a.events[f][c].handler);a.events[f].splice(c,1);}return this;};fbjs_dom.prototype.listEventListeners=function(e){e=e.toLowerCase();var a=fbjs_dom.get_data(this);var b=[];if(a.events[e])for(var c=0,d=a.events[e].length;c<d;c++)b.push(a.events[e].func);if(a.obj['on'+e])b.push(a.obj['on'+e]);return b;};fbjs_dom.prototype.purgeEventListeners=function(e){e=e.toLowerCase();var a=fbjs_dom.get_data(this);var d=a.obj;if(a.events[e])for(var b=0,c=a.events[e].length;b<c;b++)if(d.removeEventListener){d.removeEventListener(e,a.events[e][b].handler,false);}else if(d.detachEvent)d.detachEvent('on'+e,a.events[e][b].handler);return this;};fbjs_dom.prototype.callSWF=function(e){var f=fbjs_dom.get_data(this).obj;var a=new Array(arguments.length-1);var d=0;var b=null;for(var c=1;c<arguments.length;c++)a[c-1]=arguments[c];d=f.getAttribute("fbjs");b=document.so_swf_fbjs;if(b.length!==undefined)b=b[0];return b.callFlash(d,e,a);};function fbjs_fbml_dom(c,a){var b=fbjs_private.get(this);b.type=c;b.appid=a;}fbjs_fbml_dom.get_obj=function(b){var a=fbjs_private.get(b);if(!a.obj){a.obj=document.createElement('div');a.obj.className='__fbml_tag';}return a.obj;};fbjs_fbml_dom.render=function(h){var b=fbjs_private.get(h);if(b.rendered)return;if(!b.id)b.id='swf'+parseInt(Math.random()*999999);switch(b.type){case 'fb:swf':var d=new SWFObject(b.swf_src,b.id,b.width,b.height,['5.0.0'],b.bg_color?b.bg_color:'000000');var e={loop:true,quality:true,scale:true,align:true,salign:true};for(f in e)if(b[f])d.addParam(f,b[f]);d.addParam('wmode','transparent');d.addParam('allowScriptAccess','never');if(b.flash_vars)for(var f in b.flash_vars)d.addVariable(f,b.flash_vars[f]);var j=fbjs_sandbox.instances['a'+b.appid];if(j.validation_vars)for(var f in j.validation_vars)d.addVariable(f,j.validation_vars[f]);d.addVariable('fb_local_connection',j.bridgeHash);var c='_'+'swf'+parseInt(Math.random()*999999);d.addVariable('fb_fbjs_connection',c);d.addParam('fbjs',c);if(b.wait_for_click){var g=document.createElement('img');g.src=b.img_src;if(b.width)g.width=b.width;if(b.height)g.height=b.height;if(b.img_style)fbjs_dom.set_style(g,b.img_style);if(b.img_class)g.className=b.img_class;var a=document.createElement('a');a.href='#';a.onclick=function(){d.write(b.obj);return false;};a.appendChild(g);b.obj.appendChild(a);}else d.write(b.obj);break;}};fbjs_fbml_dom.prototype.setId=function(b){var a=fbjs_private.get(this);a.id=['app',a.appid,'_',b].join('');return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setSWFSrc=function(b){var a=fbjs_private.get(this);b=fbjs_sandbox.safe_string(b);if(fbjs_dom.href_regex.test(b)){a.swf_src=b;}else fbjs_console.error(b+' is not a valid swf');};fbjs_fbml_dom.prototype.setImgSrc=function(b){var a=fbjs_private.get(this);b=fbjs_sandbox.safe_string(b);if(fbjs_dom.href_regex.test(b)){a.img_src=b;}else fbjs_console.error(b+' is not a valid src');return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setWidth=function(b){var a=fbjs_private.get(this);a.width=(/\d+%?/.exec(b)||[]).pop();return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setHeight=function(b){var a=fbjs_private.get(this);a.height=(/\d+%?/.exec(b)||[]).pop();return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setImgStyle=function(c,e){var a=fbjs_private.get(this);var d=a.img_style?a.img_style:a.img_style={};if(typeof c=='string'){d[c]=e;}else for(var b in c)this.setImgStyle(b,c[b]);return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setImgClass=function(b){var a=fbjs_private.get(this);a.img_class=b;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setFlashVar=function(c,d){var a=fbjs_private.get(this);var b=a.flash_vars?a.flash_vars:a.flash_vars={};b[c]=d;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setSWFBGColor=function(a){var b=fbjs_private.get(this);if(fbjs_dom.css_regex.text(a)){b.bg_color=a;}else fbjs_console.error(a+' is not a valid background color.');return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setWaitForClick=function(b){var a=fbjs_private.get(this);a.wait_for_click=b;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setLoop=function(b){var a=fbjs_private.get(this);a.loop=b;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setQuality=function(b){var a=fbjs_private.get(this);a.quality=b;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setScale=function(b){var a=fbjs_private.get(this);a.scale=b;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setAlign=function(b){var a=fbjs_private.get(this);a.align=b;return $FBJS.ref(this);};fbjs_fbml_dom.prototype.setSAlign=function(b){var a=fbjs_private.get(this);a.salign=b;return $FBJS.ref(this);};function fbjs_event(event,a){if(!fbjs_event.hacks){fbjs_event.hacks=true;fbjs_event.should_check_double_arrows=ua.safari()&&(ua.safari()<500);fbjs_event.arrow_toggle={};}for(var c in fbjs_event.allowed_properties)this[c]=event[c];this.keyCode=this.keyCode||event.charCode;var d=null;if(event.target){d=event.target;}else if(event.srcElement)d=event.srcElement;if(d&&d.nodeType==3)d=d.parentNode;this.target=fbjs_dom.get_instance(d,a);var b=Vector2.getEventPosition(event);this.pageX=b.x;this.pageY=b.y;if(fbjs_event.should_check_double_arrows&&this.keyCode>=37&&this.keyCode<=40){fbjs_event.arrow_toggle[this.type]=!fbjs_event.arrow_toggle[this.type];if(fbjs_event.arrow_toggle[this.type])this.ignore=true;}fbjs_private.get(this).event=event;}fbjs_event.allowed_properties={type:true,ctrlKey:true,keyCode:true,metaKey:true,shiftKey:true};fbjs_event.prototype.preventDefault=function(){var a=fbjs_private.get(this);if(!a.prevented&&a.event.preventDefault){a.event.preventDefault();a.prevented=true;}a.return_value=false;};fbjs_event.prototype.stopPropagation=function(){var event=fbjs_private.get(this).event;if(event.stopPropagation){event.stopPropagation();}else event.cancelBubble=true;};fbjs_event.destroy=function(a){var b=fbjs_private.get(a).return_value;fbjs_private.remove(a);delete a.target;return b==undefined?true:b;};function fbjs_math(){}fbjs_math.prototype.abs=Math.abs;fbjs_math.prototype.acos=Math.acos;fbjs_math.prototype.asin=Math.asin;fbjs_math.prototype.atan=Math.atan;fbjs_math.prototype.atan2=Math.atan2;fbjs_math.prototype.ceil=Math.ceil;fbjs_math.prototype.cos=Math.cos;fbjs_math.prototype.exp=Math.exp;fbjs_math.prototype.floor=Math.floor;fbjs_math.prototype.log=Math.log;fbjs_math.prototype.max=Math.max;fbjs_math.prototype.min=Math.min;fbjs_math.prototype.pow=Math.pow;fbjs_math.prototype.random=Math.random;fbjs_math.prototype.round=Math.round;fbjs_math.prototype.sin=Math.sin;fbjs_math.prototype.sqrt=Math.sqrt;fbjs_math.prototype.tan=Math.tan;fbjs_math.prototype.valueOf=Math.valueOf;fbjs_math.prototype.E=Math.E;fbjs_math.prototype.LN2=Math.LN2;fbjs_math.prototype.LN10=Math.LN10;fbjs_math.prototype.LOG2E=Math.LOG2E;fbjs_math.prototype.PI=Math.PI;fbjs_math.prototype.SQRT1_2=Math.SQRT1_2;fbjs_math.prototype.SQRT2=Math.SQRT2;function fbjs_string(){}fbjs_string.prototype.fromCharCode=String.fromCharCode;function fbjs_date(){var a=function(){var b=new Date();if(arguments.length)b.setFullYear.apply(b,arguments);return b;};a.parse=Date.parse;return a;}function fbjs_regexp(){var a=function(){var b=arguments.length?new RegExp(arguments[0],arguments[1]):new RegExp();return b;};return a;}function fbjs_console(){}fbjs_console.error=function(a){if(typeof console!='undefined'&&console.error)console.error(a);};fbjs_console.render=function(d){if(d&&typeof d.__priv!='undefined'){var c={};for(var b in d)c[b]=d[b];delete c.__priv;delete c.__private;for(var b in c)c[b]=fbjs_console.render(c[b]);var e=fbjs_private.get(d);for(var b in e)c['PRIV_'+b]=e[b];if(d.__private){var e=fbjs_private.get(d.__private);for(var b in e)c['PRIV_'+b]=e[b];}return c;}else if(d&&typeof d.__instance!='undefined'&&d.setInnerFBML){var c={};for(var b in d)c[b]=d[b];delete c.__instance;c.PRIV_obj=fbjs_dom.get_obj(d);return c;}else if(d&&typeof d=='object'&&d.ownerDocument!=document){var c=d instanceof Array?[]:{};var a=false;for(var b in d){d instanceof Array?c.push(fbjs_console.render(d[b])):c[b]=fbjs_console.render(d[b]);if(c[b]!=d[b])a=true;}return a?c:d;}else return d;};fbjs_console.render_args=function(a){var c=[];for(var b=0;b<a.length;b++)c[b]=fbjs_console.render(a[b]);return c;};if(typeof console!='undefined')for(var i in console)fbjs_console.prototype[i]=console[i];fbjs_console.prototype.debug=function(){if(typeof console!='undefined'&&console.debug)console.debug.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.log=function(){if(typeof console!='undefined'&&console.log)console.log.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.warn=function(){if(typeof console!='undefined'&&console.warn)console.warn.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.error=function(){if(typeof console!='undefined'&&console.error)console.error.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.assert=function(){if(typeof console!='undefined'&&console.assert)console.assert.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.dir=function(){if(typeof console!='undefined'&&console.dir)console.dir.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.group=function(){if(typeof console!='undefined'&&console.group)console.group.apply(console,fbjs_console.render_args(arguments));};fbjs_console.prototype.dirxml=function(a){if(typeof console!='undefined'&&console.dirxml)if(a.get_obj){console.dirxml(a.get_obj(a));}else console.dirxml(a);};function fbjs_ajax(a){var d=function(){};for(var b in fbjs_ajax.prototype)d.prototype[b]=fbjs_ajax.prototype[b];var c=fbjs_private.get(d.prototype.__private={});c.appid=a;c.sandbox=fbjs_sandbox.instances['a'+a];c.request=null;d.JSON=fbjs_ajax.JSON;d.FBML=fbjs_ajax.FBML;d.RAW=fbjs_ajax.RAW;return d;}fbjs_ajax.proxy_url='/fbml/fbjs_ajax_proxy.php';fbjs_ajax.RAW=0;fbjs_ajax.JSON=1;fbjs_ajax.FBML=2;fbjs_ajax.STATUS_WAITING_FOR_USER=1;fbjs_ajax.STATUS_WAITING_FOR_SERVER=2;fbjs_ajax.STATUS_IDLE=0;fbjs_ajax.prototype.responseType=0;fbjs_ajax.prototype.useLocalProxy=false;fbjs_ajax.prototype.requireLogin=false;fbjs_ajax.prototype.status=fbjs_ajax.STATUS_IDLE;fbjs_ajax.tokencount=0;fbjs_ajax.tokens=new Object();fbjs_ajax.flash_success=function(a,b){fbjs_ajax.tokens[b].success(a);};fbjs_ajax.flash_fail=function(a){fbjs_ajax.tokens[a].fail();};fbjs_ajax.prototype.post=function(g,f){var e=fbjs_private.get(this.__private);var a=e.appid;var d=ge('post_form_id');if(!e.sandbox.data.installed&&this.requireLogin){this.status=fbjs_ajax.STATUS_WAITING_FOR_USER;FBML.requireLogin(a,function(){this.status=fbjs_ajax.STATUS_READY;e.sandbox.data.installed=true;this.post(g,f);}.bind(this),fbjs_ajax.errorHandler.bind(this));return;}if(this.useLocalProxy&&window.localProxy.callUrl&&this.responseType!=fbjs_ajax.FBML){fbjs_ajax.tokencount++;fbjs_ajax.tokens[fbjs_ajax.tokencount]={success:function(j){this.status=fbjs_ajax.STATUS_READY;this.ondone(j);}.bind(this),fail:fbjs_ajax.errorHandler.bind(this)};var h=(this.responseType==fbjs_ajax.JSON);var b=localProxy.callUrl(g+'?query='+f,h,"fbjs_ajax.flash_success","fbjs_ajax.flash_fail",fbjs_ajax.tokencount);if(!b)(fbjs_ajax.errorHandler.bind(this))();}else{var c={url:g,query:f,type:this.responseType,require_login:this.requireLogin,fb_mockajax_context:fbjs_sandbox.instances['a'+a].contextd,fb_mockajax_context_hash:fbjs_sandbox.instances['a'+a].context,appid:a};this.status=fbjs_ajax.STATUS_WAITING_FOR_SERVER;e.request=new AsyncRequest();e.request.setURI(fbjs_ajax.proxy_url).setData(c).setHandler(fbjs_ajax.doneHandler.bind(this)).setErrorHandler(fbjs_ajax.errorHandler.bind(this));if(!this.requireLogin){e.request.setReadOnly(true);e.request.specifiesWriteRequiredParams();}e.request.send();}};fbjs_ajax.prototype.abort=function(){var a=fbjs_private.get(this.__private);if(a.request)a.request.setHandler(bagofholding).setErrorHandler(bagofholding);this.status=fbjs_ajax.STATUS_READY;};fbjs_ajax.doneHandler=function(c){if(!(this.ondone instanceof Function))this.ondone=function(){};this.status=fbjs_ajax.STATUS_READY;var b=c.getPayload();var a=b.data;try{switch(b.type){case fbjs_ajax.RAW:this.ondone(a);break;case fbjs_ajax.JSON:fbjs_ajax.make_fbjs_recursive(a);this.ondone(a);break;case fbjs_ajax.FBML:this.ondone(new fbjs_fbml_string(a));break;}}finally{fbjs_sandbox.clean_mess();}};fbjs_ajax.errorHandler=function(){this.status=fbjs_ajax.STATUS_READY;if(this.onerror){try{this.onerror();}finally{fbjs_sandbox.clean_mess();}}else fbjs_console.error('There was an uncaught Ajax error. Please attach on onerror handler to properly handle failures.');};fbjs_ajax.make_fbjs_recursive=function(b){for(var a in b)if(a.substring(0,5)=='fbml_'){b[a]=new fbjs_fbml_string(b[a]);}else if(typeof b[a]=='object')fbjs_ajax.make_fbjs_recursive(b[a]);};function fbjs_dialog(a){var c=function(e){var d=fbjs_private.get(this);switch(e){case fbjs_dialog.DIALOG_CONTEXTUAL:d.dialog=new ContextualDialog();break;case fbjs_dialog.DIALOG_POP:default:d.dialog=new Dialog();break;}d.dialog.setImmediateRendering(true).setClassName('app_content_'+a).setStackable(true);d.type=e;d.ready=false;};for(var b in fbjs_dialog.prototype)c.prototype[b]=fbjs_dialog.prototype[b];c.DIALOG_POP=fbjs_dialog.DIALOG_POP;c.DIALOG_CONTEXTUAL=fbjs_dialog.DIALOG_CONTEXTUAL;return c;}fbjs_dialog.DIALOG_POP=1;fbjs_dialog.DIALOG_CONTEXTUAL=2;fbjs_dialog.onconfirm=function(){var a=true;try{if(this.onconfirm)if(this.onconfirm()===false)a=false;}finally{fbjs_sandbox.clean_mess();}if(a)this.hide();return false;};fbjs_dialog.oncancel=function(){var a=true;try{if(this.oncancel)if(this.oncancel()===false)a=false;}finally{fbjs_sandbox.clean_mess();}if(a)this.hide();return false;};fbjs_dialog.build_dialog=function(){var a=fbjs_private.get(this);if(!a.ready){a.dialog._buildDialog();a.ready=true;}};fbjs_dialog.prototype.setStyle=function(c,d){var b=fbjs_private.get(this);fbjs_dialog.build_dialog.call(this);var a=null;if(c=='width'||c=='height'){a=b.type==fbjs_dialog.DIALOG_CONTEXTUAL?b.dialog._frame:b.dialog._frame.parentNode;}else a=b.dialog._content;fbjs_dom.set_style(a,c,d);return $FBJS.ref(this);};fbjs_dialog.prototype.showMessage=function(c,b,a){this.showChoice(c,b,a,false);return $FBJS.ref(this);};fbjs_dialog.prototype.showChoice=function(h,f,a,c){var g=fbjs_private.get(this).dialog;fbjs_dialog.build_dialog.call(this);var e=[];var b=a?fbjs_fbml_string.get(a):_tx("Okay");e.push({label:b,name:'button1',handler:bind(this,fbjs_dialog.onconfirm)});if(c||c===undefined){var d=c?fbjs_fbml_string.get(c):_tx("Cancel");e.push({label:d,name:'button2',handler:bind(this,fbjs_dialog.oncancel)});}g.setTitle(fbjs_fbml_string.get(h)).setBody(fbjs_fbml_string.get(f)).setButtons(e).show();g._content.id='app_content_'+(+new Date());return $FBJS.ref(this);};fbjs_dialog.prototype.setContext=function(b){var a=fbjs_private.get(this).dialog;var c=fbjs_dom.get_obj(b);a.setContext(c);return $FBJS.ref(this);};fbjs_dialog.prototype.hide=function(){var a=fbjs_private.get(this).dialog;a.hide();return $FBJS.ref(this);};function fbjs_animation(){var b=function(c){if(this==window){return new arguments.callee(fbjs_dom.get_obj(c));}else{fbjs_private.get(this).animation=new animation(c);fbjs_private.get(this).animation._show=function(){this.obj.style.display='block';};fbjs_private.get(this).animation._hide=function(){this.obj.style.display='none';};}};for(var a in fbjs_animation.prototype)b.prototype[a]=fbjs_animation.prototype[a];b.ease={begin:animation.ease.begin,end:animation.ease.end,both:animation.ease.both};return b;}fbjs_animation.prototype.stop=function(){fbjs_private.get(this).animation.stop();return this;};fbjs_animation.prototype.to=function(a,b){fbjs_private.get(this).animation.to(a,b);return this;};fbjs_animation.prototype.by=function(a,b){fbjs_private.get(this).animation.by(a,b);return this;};fbjs_animation.prototype.from=function(a,b){fbjs_private.get(this).animation.from(a,b);return this;};fbjs_animation.prototype.duration=function(a){fbjs_private.get(this).animation.duration(a);return this;};fbjs_animation.prototype.checkpoint=function(b,a){var c=this;fbjs_private.get(this).animation.checkpoint(b,typeof a=='function'?function(){try{a.call(c);}finally{fbjs_sandbox.clean_mess();}}:null);return this;};fbjs_animation.prototype.ondone=function(a){var b=this;if(typeof a=='function'){fbjs_private.get(this).animation.checkpoint(function(){try{a.call(b);}finally{fbjs_sandbox.clean_mess();}});return this;}};fbjs_animation.prototype.blind=function(){fbjs_private.get(this).animation.blind();return this;};fbjs_animation.prototype.show=function(){fbjs_private.get(this).animation.show();return this;};fbjs_animation.prototype.hide=function(){fbjs_private.get(this).animation.hide();return this;};fbjs_animation.prototype.ease=function(a){fbjs_private.get(this).animation.ease(a);return this;};fbjs_animation.prototype.go=function(){fbjs_private.get(this).animation.go();return this;};function fbjs_livemessage(a){var c=function(e,d){if(!e)throw ('Parameter "event_name" must be non-empty.');var f=fbjs_private.get(this);f.appid=a;f.event_name=e;f.send_success_handler=null;f.send_error_handler=null;f.livemessage=new LiveMessageReceiver(e).setAppId(a).setHandler(d).register();};for(var b in fbjs_livemessage.prototype)c.prototype[b]=fbjs_livemessage.prototype[b];return c;}fbjs_livemessage.prototype.send=function(c,a){if(!c)throw ('Parameter "recipient" must be non-empty.');var b=fbjs_private.get(this);new AsyncRequest().setURI('/fbml/ajax/livemessage_send.php').setData({app_id:b.appid,recipient:c,event_name:b.event_name,message:JSON.stringify(a)}).setMethod('POST').setHandler(function(e){payload=e.getPayload();if(payload.error_code){var d=b.send_error_handler;if(d)try{d(payload.error_code,payload.error_msg,c,a);}finally{fbjs_sandbox.clean_mess();}}else{var f=b.send_success_handler;if(f)try{f(c,a);}finally{fbjs_sandbox.clean_mess();}}}).setErrorHandler(function(e){var d=b.send_error_handler;if(d)try{d(e.getError(),e.getErrorSummary(),c,a);}finally{fbjs_sandbox.clean_mess();}}).send();};fbjs_livemessage.prototype.setSendSuccessHandler=function(a){var b=fbjs_private.get(this);b.send_success_handler=a;return $FBJS.ref(this);};fbjs_livemessage.prototype.setSendErrorHandler=function(a){var b=fbjs_private.get(this);b.send_error_handler=a;return $FBJS.ref(this);};fbjs_livemessage.prototype.setShutdownHandler=function(a){var b=fbjs_private.get(this);b.livemessage.setShutdownHandler(a);return $FBJS.ref(this);};fbjs_livemessage.prototype.setRestartHandler=function(a){var b=fbjs_private.get(this);b.livemessage.setRestartHandler(a);return $FBJS.ref(this);};function fbjs_fbml_string(a,b){a=HTML(a);if(b)a.setAction(b);fbjs_private.get(this).htmlstring=a;}fbjs_fbml_string.get=function(a){if(a instanceof fbjs_fbml_string){return fbjs_private.get(a).htmlstring.toString();}else return htmlspecialchars(fbjs_sandbox.safe_string(a));};fbjs_private=new Object();fbjs_private.len=0;fbjs_private.get=function(a){if(typeof a!='object')return null;if(a==window)throw ('Invalid object supplied');if(a.__priv==undefined){var b={data:{},instance:a};a.__priv=fbjs_private.len;fbjs_private.len++;b.instance=a;fbjs_private[a.__priv]=b;return b.data;}else if(typeof a.__priv=='number'){var b=fbjs_private[a.__priv];if(b.instance==a){return b.data;}else throw ('Invalid object supplied to fbjs_private.get');}else throw ('Invalid object supplied to fbjs_private.get');};fbjs_private.remove=function(a){if(a.__priv!=undefined)if(fbjs_private[a.__priv].instance==a){delete fbjs_private[a.__priv];delete a.__priv;}};function fbjs_fbml_sanitize(appid){this.appid=appid;this.main=eval('a'+appid+'_document');return this;}fbjs_fbml_sanitize.prototype.parseFBML=function(c){if(window.ActiveXObject){var a=new ActiveXObject("Microsoft.XMLDOM");a.async="false";a.loadXML(c);if(a.parseError.reason){fbjs_console.error(a.parseError.reason);return null;}}else{var b=new DOMParser();var a=b.parseFromString(c,"text/xml");if(a.documentElement.nodeName=='parsererror'){fbjs_console.error(a.documentElement.textContent);return null;}}var d=a.documentElement;return this.processElement(d);};fbjs_fbml_sanitize.prototype.processElement=function(h){if(h.nodeType==3){return new fbjs_dom(document.createTextNode(h.nodeValue),this.appid);}else if(h.nodeType!=1)return null;var e=this.main.createElement(h.nodeName);if(!e)return null;for(var k=0;k<h.attributes.length;k++){var b=h.attributes[k];var a=b.nodeName;if(a=='style'){var f=b.nodeValue.split(";");for(var g=0;g<f.length;g++)if(f[g]!=''){var j=f[g].split(":");e.setStyle(j[0],j[1].replace(/^\s+|\s+$/g,''));}}else{setter=fbjs_dom.attr_setters[a];if(e[setter])e[setter](b.nodeValue);}}for(var k=0;k<h.childNodes.length;k++){var d=h.childNodes[k];var c=this.processElement(d);if(c)e.appendChild(c);}return e;};var fbjs_helper={disable_element:function(a){delete fbjs_main.allowed_elements[a];}};Array.prototype.pull=function(b){if(this===window)throw new TypeError();if(typeof b=='string')return this.map(function(c){return c[b];});if(typeof b=='function'){var a=[].slice.call(arguments,1);return this.map(function(c){c._;return b.apply(c,a);});}throw new TypeError();};Arbiter.inform('fbjs_initialized',null,Arbiter.BEHAVIOR_STATE);
function UIErrorForm(c,a,d,b,e){this.container=a;if(!is_empty(d)){this.form=$(d);Event.listen(this.form,'submit',coalesce(e,this.onSubmit).bind(this));}this.errorMap=c;this.displayedErrors={};this.endpoint=b;}UIErrorForm.prototype={attachError:function(b,c){if(!(b in this.errorMap)){var d=DOM.find(this.container,'div[id="UIErrorForm_GenericError"]');var j=$N('h2',{className:'"main_message'},HTML(c));var e=DOM.scry(this.container,'div[id="error_div"]')[0];if(e){DOM.appendContent(e,j);}else{e=$N('div',{id:'error_div',className:"UIMessageBox UIMessageBoxError"},j);DOM.setContent(d,j);show(d);}return;}var f=DOM.find(this.container,'div[id="'+this.errorMap[b]+'_div"]');var h=DOM.find(this.container,'span[id="'+this.errorMap[b]+'_span"]');var g=DOM.find(this.container,'[id="'+this.errorMap[b]+'"]');this.displayedErrors[b]=true;var e=$N('strong',{className:'UIErrorForm_Flag_Inner'},c);var i=$N('strong',{className:'UIErrorForm_Flag',id:b},e);var a=intl_locale_is_rtl()?'right':'left';CSS.setStyle(i,a,'105%');DOM.insertAfter(g,i);CSS.addClass(h,'UIErrorForm_ErrorField');},toggleError:function(a,d){if(this.displayedErrors[a]==d)return;var b=DOM.find(this.container,'strong[id="'+a+'"]');var c=DOM.find(this.container,'span[id="'+this.errorMap[a]+'_span"]');if(d){CSS.addClass(c,'UIErrorForm_ErrorField');CSS.show(b);}else{CSS.removeClass(c,'UIErrorForm_ErrorField');CSS.hide(b);}this.displayedErrors[a]=d;},clearErrors:function(){for(var a in this.displayedErrors)this.toggleError(a,false);var b=DOM.scry(this.container,'div[id="error_box_div"]')[0];if(b)DOM.empty(b);},enableButton:function(a){button=$(a);if(button){Button.setEnabled(button,true);button.disabled=false;}},displayErrors:function(b){this.clearErrors();if(!b)return;for(var a in b)if(a in this.displayedErrors){this.toggleError(a,true);}else this.attachError(a,b[a]);},errorHandler:function(b){var a=b.getPayload();this.displayErrors(a.error_codes);if(a.button_to_enable_on_error)this.enableButton(a.button_to_enable_on_error);},onSubmit:function(){var a=Form.serialize(this.form);var b=new AsyncRequest().setURI(this.endpoint).setData(a).setHandler(this.clearErrors.bind(this)).setErrorHandler(this.errorHandler.bind(this));this.clearErrors();b.send();return false;}};
function Validator(){}copy_properties(Validator,{validate_zip_for_country:function(a,b){if(a=='US'){if(b.match(/^[0-9]{5}(-[0-9]{4}){0,1}$/)){return b;}else if(b.match(/^[0-9]{9}$/)){b=b.slice(0,5)+'-'+b.slice(5);return b;}}else if(a=='CA'){if(b.match(/^[a-zA-Z][0-9][a-zA-z] *[0-9][a-zA-Z][0-9]$/)){b=b.slice(0,3)+' '+b.slice(-3);b=b.toUpperCase();return b;}}else if(a=='GB'){if(b.match(/^[a-zA-Z][a-zA-Z]?[0-9][0-9a-zA-Z]? *[0-9][a-zA-Z][a-zA-Z]$/)){b=b.replace(/^([a-zA-Z][a-zA-Z]?[0-9][0-9a-zA-Z]?) *([0-9][a-zA-Z][a-zA-Z])$/,'$1 $2');b=b.toUpperCase();return b;}}else return b;return null;}});
function UICreditCardForm(b,a,e,c,d,f,g){this.useTokenizer=g;if(this.useTokenizer){this.responseEndpoint='/ajax/payment/token_proxy.php';}else this.responseEndpoint='/ajax/payment/CreditCardFormResponse.php';this.parent.construct(this,b,a,e,this.responseEndpoint,null);this.errorStrings=c;this.finalPostUri=d;this.prevLogoId=null;this.ccNumberInput=null;this.ccLogoMap={77:'mc_logo',86:'visa_logo',65:'amex_logo',74:'disc_logo',68:'jcb_logo',64:null,85:null};if(f){this.logKeypressTimestamps=true;this.ccNumberInput=DOM.find(this.container,'input[name="cc_creditCardNumber"]');Event.listen(this.ccNumberInput,'keyup',this.keyupHandler.bind(this));}}UICreditCardForm.extend('UIErrorForm');UICreditCardForm.prototype={onSubmit:function(){if(this.validate()){this.storeKeypress();var a=Form.serialize(this.form);var b=DOM.scry(this.container,'input[id="for_edit"]')[0];if(!b)a.cc_creditCardNumber=this.cleanCCNumber(a.cc_creditCardNumber);var c=new AsyncRequest().setURI(this.endpoint).setData(a).setHandler(this.post_register_card.bind(this)).setErrorHandler(this.errorHandler.bind(this));this.clearErrors();c.send();}return false;},post_register_card:function(b){this.clearErrors();if(this.finalPostUri){var a=Form.serialize(this.form);if(this.useTokenizer){delete a.cc_creditCardNumber;delete a.cc_cvv2;}a.cc_id=b.getPayload().cc_id;Form.post(this.finalPostUri,a);}},errorHandler:function(b){var a=b.getPayload();if(!a)a={error_codes:{CC_PAY_INTERNAL_ERROR:this.errorStrings.CC_PAY_INTERNAL_ERROR}};this.displayErrors(a.error_codes);if(a.button_to_enable_on_error)this.enableButton(a.button_to_enable_on_error);},validate_state_for_country:function(){var a=DOM.find(this.container,'select[name="cc_countryCode"]').value;var b=trim(DOM.find(this.container,'input[name="cc_state"]').value);if((a=='US'||a=='CA')&&b==='')return null;return b;},validate:function(){var i={};var r={};var p=DOM.scry(this.container,'input[id="for_edit"]')[0];var l=DOM.scry(this.container,'input[id="fewer_fields"]')[0];var m=DOM.scry(this.container,'input[id="fewer_fields_except_zip"]')[0];r.cc_cvv2='CC_CVV2_INVALID';if(!p){r.cc_firstName='CC_NO_FIRSTNAME';r.cc_lastName='CC_NO_LASTNAME';r.cc_creditCardNumber='CC_NO_NUMBER';}if(!l&&!m){r.cc_street='CC_NO_STREET';r.cc_city='CC_NO_CITY';}for(var o in r){var n=DOM.scry(this.container,'input[name="'+o+'"]')[0];if(n&&n.value.length<=0)i[o]=r[o];}if(!l){var c=DOM.find(this.container,'select[name="cc_countryCode"]').value;var t=trim(DOM.find(this.container,'input[name="cc_zip"]').value);t=Validator.validate_zip_for_country(c,t);if(t===null)i.cc_zip='CC_NO_ZIP';}if(!l&&!m){var s=this.validate_state_for_country();if(s===null)i.cc_state='CC_NO_STATE';}var j=DOM.find(this.container,'select[name="cc_expMonth"]').value;var k=DOM.find(this.container,'select[name="cc_expYear"]').value;if(isNaN(j)||j<1||j>12||isNaN(k)||k<2009||k>2099)i.cc_expYear='CC_INVALID_YEAR';var q=new Date();var d=q.getMonth()+1;var e=q.getFullYear();if(k<e||(k==e&&j<d))i.cc_expYear='CC_EXPIRED_ALREADY';if(!('cc_cvv2' in i)){var f=DOM.find(this.container,'input[name="cc_cvv2"]').value;if(f.length<3||f.length>4||isNaN(f))i.cc_cvv2='CC_CVV2_INVALID';}if(!p&&!('cc_creditCardNumber' in i)){var a=this.ccNumberInput.value;if(/[^\-\s\d]/.test(a))i.cc_creditCardNumber='CC_INVALID_NUMBER_BAD_CHARS';var b=this.cleanCCNumber(a);if(b.length<13){i.cc_creditCardNumber='CC_INVALID_NUMBER';}else if(!this.validateCCNumber(b)){i.cc_creditCardNumber='CC_BAD_CARD_NUMBER';}else if(!this.validateCCType(b))i.cc_creditCardNumber='CC_CARD_TYPE_NOT_VALID';}if(is_empty(i))return true;var g={};for(o in i){var h=i[o];g[h]=this.errorStrings[h];}this.displayErrors(g);return false;},cleanCCNumber:function(a){return a.replace(/[^\d]/gi,'');},validateCCNumber:function(b){var f=b.split('').reverse();var e='';for(var c=0;c<f.length;c++){var a=parseInt(f[c],10);if(c%2!=0)a=a*2;e=e+a;}var d=0;for(c=0;c<e.length;c++)d=d+parseInt(e.charAt(c),10);return (d!=0&&d%10==0);},getCCType:function(b){var a=b.substr(0,6);if(a.match(/^5[1-5]/)){return 77;}else if(a.match(/^4/)){return 86;}else if(a.match(/^3[47]/)){return 65;}else if(a.match(/^35(2[8-9]|[3-8])/)){return 74;}else if(a.match(/^(6011|65|64[4-9]|622([2-8]|1[3-9]|12[6-9]|9[0-1]|92[0-5]))/)){return 68;}else if(a.match(/^30[0-5]/))return 64;return 85;},selectCCLogo:function(a){var e=this.getCCType(a);var d=this.ccLogoMap[e];for(var c in this.ccLogoMap)if(this.ccLogoMap[c]&&d!=this.prevLogoId){var b=d&&d!=this.ccLogoMap[c];CSS.conditionClass(this.ccLogoMap[c],'unselected',b);}this.prevLogoId=d;},validateCCType:function(a){var b=DOM.scry(this.container,'input[name="supported_cards"]')[0];if(!b||b.value.match(this.getCCType(a)))return true;return false;},keyupHandler:function(){var a=this.cleanCCNumber(this.ccNumberInput.value);this.logKeypress(a);this.selectCCLogo(a);},keypressTime:[],logKeypressTimestamps:false,logKeypress:function(a){var b=new Date().getTime();if(a.length<this.keypressTime.length)this.keypressTime=this.keypressTime.slice(0,a.length);while(this.keypressTime.length<a.length)this.keypressTime[this.keypressTime.length]=b;},storeKeypress:function(){if(this.logKeypressTimestamps){var a=this.cleanCCNumber(this.ccNumberInput.value);this.logKeypress(a);DOM.find(this.container,'input[name="cc_misc_data"]').value=Base64.encode(JSON.stringify(this.keypressTime));}}};
function CreditsBalanceUpdater(){}CreditsBalanceUpdater.UPDATE='creditsBalance/update';CreditsBalanceUpdater.negBalance='negativeBalance';CreditsBalanceUpdater.repay='needsRepayment';CreditsBalanceUpdater.prototype={init:function(b,a){this.root=b;this.targetBalance=DOM.find(this.root,'span.creditsBalance');Arbiter.inform(CreditsBalanceUpdater.UPDATE,a,Arbiter.BEHAVIOR_STATE);Arbiter.subscribe(CreditsBalanceUpdater.UPDATE,this.oninform.bind(this),Arbiter.SUBSCRIBE_NEW);new LiveMessageReceiver('update_canvas_balance').setHandler(this.oninform_livemessage.bind(this)).register();},oninform_livemessage:function(a){this.oninform(CreditsBalanceUpdater.UPDATE,a);},oninform:function(c,b){if(c==CreditsBalanceUpdater.UPDATE){var a=ge('get_more_link');if(b>=0){CSS.removeClass(this.root,CreditsBalanceUpdater.negBalance);a&&CSS.removeClass(a,CreditsBalanceUpdater.repay);}else{CSS.addClass(this.root,CreditsBalanceUpdater.negBalance);a&&CSS.addClass(a,CreditsBalanceUpdater.repay);}DOM.setContent(this.targetBalance,b);}}};
function FlowRequest(a){this.parent.construct(this,'/ajax/flows/');this._initialize(a);}FlowRequest.extend('AsyncRequest');FlowRequest.prototype={_data:{timeStart:0,timeElapsed:0,methodName:null,errorCode:0,samplingRate:1000},_initialize:function(a){this._data.timeStart=Number(new Date());this._data.methodName='JS:'+a;this.parent.setFinallyHandler(this.statsSignal.bind(this));},_shouldSample:function(){return (rand32()%this._data.samplingRate==0);},statsSignal:function(){this._data.timeElapsed=(Number(new Date())-this._data.timeStart)*1000;this._data.timeStart=Math.round(this._data.timeStart/1000);if(this._shouldSample())new AsyncSignal('/ajax/flows/payments/log.php',this._data).send();}};
GiftCredits={PLACE_APP:'app',PLACE_GIFTSHOP:'giftshop',dialog:null,callback:null,purchaseLock:false,purchaseLockExpiryThreshold:5000,purchaseLockTimeoutId:null,getUserBalance:function(a){var b=function(d){if(ge(a))DOM.setContent($(a),d.getPayload());};var c=new FlowRequest('GetBalance').setURI('/ajax/giftcredits/balance.php').setHandler(b.bind(this)).send();},getPurchaseCreditPrompt:function(b,c,d,a){GiftCredits.main(b,null,null,null,d,null,null,null,true,{},a);},redeemGiftcard:function(b,a){GiftCredits.main(b,null,null,document.location.toString(),null,null,null,null,true,{shortcut:'giftcard'},a);},getPrompt:function(c,k,i,d,e,j,b,f,g,h,a){GiftCredits.main(c,k,i,d,e,j,b,f,g,h,a);},main:function(c,m,j,e,f,l,b,g,h,i,a){if(window!=window.top)return false;if(GiftCredits.isPurchaseLocked())return false;GiftCredits.setPurchaseLock(true);var k={method:'pay',display:'async',app_id:c,receiver:m,api_key:b,credits_purchase:h,next:e,place:l||GiftCredits.PLACE_APP,dev_purchase_params:JSON.stringify(i),additional_params:JSON.stringify(a),order_info:JSON.stringify(j)};var d=new AsyncRequest().setURI('/fbml/ajax/uiserver.php').setData(k).setMethod('GET').setReadOnly(true);GiftCredits.callback=f;GiftCredits.dialog=new Dialog().setAsync(d).setModal(true).setCancelHandler(GiftCredits.onCancel).setCloseHandler(f).show();},onCancel:function(c){var b=Dialog.getCurrent();if(b&&!(b.getButtonElement(Dialog.CANCEL)||c))return false;if(GiftCredits.callback){var a={error_code:1383010,error_message:'User canceled the order.'};GiftCredits.callback(a);}GiftCredits.setPurchaseLock(false);if(c)GiftCredits.dialog.hide();},isPurchaseLocked:function(){return GiftCredits.purchaseLock;},setPurchaseLock:function(a){GiftCredits.purchaseLock=a;if(a){GiftCredits.purchaseLockTimeoutId=setTimeout(function(){GiftCredits.setPurchaseLock(false);},GiftCredits.purchaseLockExpiryThreshold);}else clearTimeout(GiftCredits.purchaseLockTimeoutId);return true;}};function triggerCreditsPromptFromXd(b,a){callback=function(c){XD.send({response:JSON.stringify(c)},a.channel);};GiftCredits.getPrompt(a.app_id,a.receiver,a.order_info,a.back_url,callback,null,null,null,a.credits_purchase,a.dev_purchase_params,a.additional_params);}onloadRegister(function(){Arbiter.subscribe('Connect.Unsafe.Pay.Prompt',triggerCreditsPromptFromXd);});
function InstrumentedLogger(a){if(this===window)return new InstrumentedLogger(a);if(InstrumentedLogger._instances[a])return InstrumentedLogger._instances[a];copy_properties(this,{id:a,_phases:{}});return InstrumentedLogger._instances[a]=this;}copy_properties(InstrumentedLogger,{_instances:{}});copy_properties(InstrumentedLogger.prototype,{beginPhase:function(a){if(this._phases[a]&&this._phases[a].start)this.endPhase(a);if(typeof(this._phases[a])=='undefined')this._phases[a]={start:0,count:0,duration:0};this._phases[a].start=new Date().getTime();return this;},endPhase:function(a){var b=this._phases[a];if(b&&b.start){b.count++;b.duration+=new Date().getTime()-b.start;b.start=null;}return this;},dumpAndReset:function(){this.dump();return this.reset();},dump:function(){for(var b in this._phases){var c=this._phases[b];var a=(this.id?this.id+'::':'')+b;}return this;},get:function(a){if(this._phases[a])return this._phases[a].duration/this._phases[a].count;return 0;},reset:function(){this._phases={};return this;}});InstrumentedLogger.prototype.b=InstrumentedLogger.prototype.beginPhase;InstrumentedLogger.prototype.e=InstrumentedLogger.prototype.endPhase;InstrumentedLogger.prototype.d=InstrumentedLogger.prototype.dump;InstrumentedLogger.prototype.D=InstrumentedLogger.prototype.dumpAndReset;InstrumentedLogger.prototype.r=InstrumentedLogger.prototype.reset;var IL=InstrumentedLogger;
function Template(a){copy_properties(this,{_templateSource:a});}copy_properties(Template,{_operatorRepeat:function(d,a){var f='';var c=d.match(/([^:]*):(.*)/);if(!(!c))if(!(!TemplateRegistry.hasTemplate(c[2])))if(a[c[1]]){var e=TemplateRegistry.getTemplate(c[2]);var b=$A(a[c[1]]);f+=b.map(function(h,g){return h.render(g);}.curry(e)).join(' ');}return f;}});copy_properties(Template.prototype,{getSource:function(){return this._templateSource;},render:function(b){var a=function(d,c,f,e){switch(f){case 'H':return d[e]||'';case 'R':return Template._operatorRepeat(e,d);default:if(!d[e])return '';return window.HTML&&HTML.isHTML(d[e])?d[e].getContent():htmlize(d[e]);}return d[e]?translator(d[e]):'';}.curry(b||{});return this._templateSource.replace(/\$(H|R)?{([^\}]*)\}/g,a);}});var TemplateRegistry={_storage:{},registerTemplate:function(a,b){if(typeof(b)=="string")b=new Template(b);this._storage[a]=b;return this;},unregisterTemplate:function(a){delete this._storage[a];},hasTemplate:function(a){return a in this._storage;},getTemplate:function(a){if(this.hasTemplate(a))return this._storage[a];return null;},registerServerSideTemplate:function(d,b,e,c){b=b||bagofholding;e=!!e;c=!!c;if(this.hasTemplate(d)){b();return this;}var a=new AsyncRequest(d).setReadOnly(true).setMethod('GET').setOption('asynchronous',!e).setOption('suppressEvaluation',!c);if(!e)a.setErrorHandler(this._registerErrorHandler.bind(this,d)).setHandler(this._registerHandler.bind(this,d,c,b));a.send();if(e){var f=this._stripHasteComments(a.transport.responseText);this.registerTemplate(d,new Template(f));b();}return this;},_registerErrorHandler:function(a,b){},_registerHandler:function(c,b,a,e){var d=e.getPayload();var f=null;if(b){if(d.template)f=d.template;}else f=this._stripHasteComments(d.responseText);if(f){this.registerTemplate(c,f);a();}},_stripHasteComments:function(a){return a.replace(/^\s*\/\*\*?(.|\n)*\*\//m,'');},_onRegisterTemplate:function(b,a){if(b=='template/registerTemplate'){if(!(!a||!a.name||!a.template))this.registerTemplate(a.name,a.template);return false;}return true;}};Arbiter.subscribe('template/registerTemplate',TemplateRegistry._onRegisterTemplate.bind(TemplateRegistry),Arbiter.SUBSCRIBE_ALL);
Arbiter.inform("template\/registerTemplate",{name:"\/templates\/UIPager.tmpl",template:"\n\u003cspan class=\"UIPager\" bindPoint =\"root\">\n  \u003cspan class=\"UIPager_PageNum\" bindPoint=\"pageNumber\">\u003c\/span>\n  \u003cspan class=\"UIPager_ButtonWrapper\" bindPoint=\"backWrapper\">\n    \u003ca class=\"UIPager_Button UIPager_ButtonBack\" bindPoint=\"backRoot\" href=\"#\">\u003c\/a>\n  \u003c\/span>\n  \u003cspan class=\"UIPager_ButtonWrapper\" bindPoint=\"forwardWrapper\">\n    \u003ca class=\"UIPager_Button UIPager_ButtonForward\" bindPoint=\"forwardRoot\" href=\"#\">\u003c\/a>\n  \u003c\/span>\n\u003c\/span>\n"},Arbiter.BEHAVIOR_PERSISTENT);
function TemplateObject(c,a){a=a||{};if(!(c instanceof Template))if(TemplateRegistry.hasTemplate(c)){c=TemplateRegistry.getTemplate(c);}else if(c instanceof URI){TemplateRegistry.registerServerSideTemplate(c.toString(),null,true);c=TemplateRegistry.getTemplate(c);}if(c==null)throw new Error("Template could not be found");var b=c.render(a);copy_properties(this,{_nodes:HTML(b).getNodes(),_template:c,_rendered:b});TemplateObject.bindNodes(this._nodes,this);}copy_properties(TemplateObject,{bindNodes:function(f,g){var a=[];for(var c=0;c<f.length;c++)if(f[c].nodeType==DOM.NODE_TYPES.ELEMENT){a.push(f[c]);var e=f[c].getElementsByTagName('*');a=a.concat($A(e));}for(var c=0;c<a.length;c++){var b=a[c].getAttribute('bindPoint');var d=a[c].getAttribute('listen');if(b)if(hasArrayNature(g[b])){g[b].push(a[c]);}else g[b]=a[c];if(d)d.replace(/(\w+) *: *(\w+)/g,function(k,j,h,i){if(typeof(this[i])=="function"){Event.listen(k,h,bind(this,this[i]));}else Event.listen(k,h,bind(this,TemplateObject._eventWrapper,i));}.bind(g,a[c]));}},_eventWrapper:function(a,event){if(typeof(this[a])=="function"){return this[a](event);}else return true;}});copy_properties(TemplateObject.prototype,{getNodes:function(){return this._nodes;},getRendered:function(){return this._rendered;}});
function UIPager(d,b,c,a){copy_properties(this,{_rm:new RenderManager(this),_callback:a||bagofholding,_backHandler:null,_forwardHandler:null,_maxPerPage:b,_total:d,_offset:c,_isDisabled:false,root:null,backRoot:null,forwardRoot:null,pageNumber:null,backWrapper:null,fowardWrapper:null});this.parent.construct(this,URI('/templates/UIPager.tmpl'));this._summaryTextHandler=this._getSummaryText;this._rm.dirty();this._setupHandlers();return this;}UIPager.extend('TemplateObject');UIPager.prototype._setupHandlers=function(){this._backHandler=Event.listen(this.backRoot,'click',this._handleClick.bind(this,'back'));this._forwardHandler=Event.listen(this.forwardRoot,'click',this._handleClick.bind(this,'forward'));};UIPager.prototype._handleClick=function(b){var c;var a;if(b=='forward'){c=this.forwardWrapper;a=1;}else{c=this.backWrapper;a=-1;}if(!CSS.hasClass(c,'UIPager_ButtonDisabled')){this._offset=this._offset+(a*this._maxPerPage);this._callback(this._offset,a);this._rm.dirty();}return false;};UIPager.prototype._getSummaryText=function(a,e,b){if(e==0)return '';if(e<=b){if(e==1){return _tx("1 result");}else return _tx("{number_of_results} results",{number_of_results:e});}else{if(a+b<e){var c=((a/b+1)*b);}else var c=e;if(e>500){var d=_tx("{starting_offset}-{ending_offset} of over {number_of_results} results",{starting_offset:(a+1),ending_offset:c,number_of_results:500});}else var d=_tx("{starting_offset}-{ending_offset} of {number_of_results} results",{starting_offset:(a+1),ending_offset:c,number_of_results:e});return d;}};UIPager.prototype.setCallback=function(a){this._callback=a;return this;};UIPager.prototype.setMaxPerPage=function(a){this._maxPerPage=Math.max(a,0);this._rm.dirty();return this;};UIPager.prototype.setTotal=function(a){this._total=Math.max(a,0);this._rm.dirty();return this;};UIPager.prototype.setOffset=function(a){this._offset=Math.max(a,0);this._rm.dirty();return this;};UIPager.prototype.setPage=function(a){this._offset=Math.max(a-1,0)*this._maxPerPage;this._rm.dirty();return this;};UIPager.prototype.setDisabled=function(a){this._isDisabled=a;this._rm.dirty();return this;};UIPager.prototype.setVertical=function(a){CSS.conditionClass(this.root,'UIPager_Vertical',a);this._rm.dirty();return this;};UIPager.prototype._getCurrentPage=function(){return this._offset/this._maxPerPage+1;};UIPager.prototype._getPageCount=function(){return Math.ceil(this._total/this._maxPerPage);};UIPager.prototype.setSummaryTextHandler=function(a){this._summaryTextHandler=a;this._rm.dirty();return this;};UIPager.prototype._setDisabled=function(a,c){var b;if(a=="back"){b=this.backWrapper;}else if(a=="forward")b=this.forwardWrapper;CSS.conditionClass(b,'UIPager_ButtonDisabled',c);return this;};UIPager.prototype.paint=function(){if(this._offset==0||this._isDisabled){this._setDisabled("back",true);}else this._setDisabled("back",false);if((this._offset+this._maxPerPage)>=this._total||this._isDisabled){this._setDisabled("forward",true);}else this._setDisabled("forward",false);var a=this._summaryTextHandler(this._offset,this._total,this._maxPerPage);if(a){DOM.setContent(this.pageNumber,a);}else hide(this.pageNumber);};UIPager.prototype.resetPager=function(d,b,c,a){this.setOffset(c);this.setTotal(d);this.setMaxPerPage(b);if(a)this._callback=a;this._rm.dirty();};UIPager.prototype.getRoot=function(){return this.root;};UIPager.prototype.setHidden=function(a){CSS.conditionClass(this.root,'hidden_elem',a);return this;};UIPager.prototype.getHidden=function(){return CSS.hasClass(this.root,'hidden_elem');};
function GiftsMall(e,b,c,d){this.root=e;this.directory=b;this.current=c;this.home=c;this.virtualGiftsId=DOM.find(this.root,'.VIRTUAL-GIFTS').id;var a=DOM.find(this.root,'div.dark_loaded').childNodes||[];$A(a).map(function(f){hide(f);this.root.appendChild(f);}.bind(this));this.switchTo(d);Arbiter.subscribe(GiftsMall.SWITCH_TO,function(h,f){var g=f.id||this.home;this.directory[g]&&this.switchTo(g);}.bind(this));}GiftsMall.prototype={switchTo:function(a){if(!this.directory[a])return;var b=this.current;if(a==b)return;GiftshopController.log('switchTo-'+a);Arbiter.inform(GiftsMall.SET_PURCHASE_BUTTON,{enable:false,buttonText:_tx("Buy Gift")},Arbiter.BEHAVIOR_STATE);GiftStoreManager.getInstance().clearAppOrderInfo();if(typeof this.directory[a].virtualGiftsTag=='number'){GiftshopController.selectBrowseTag(this.directory[a].virtualGiftsTag);GiftStoreManager.getInstance().resetSku();}if(this.directory[a].isVirtualGiftsShortcut)a=this.virtualGiftsId;if(!(ge(a)))if(this.directory[a].html){DOM.appendContent(this.root,HTML(this.directory[a].html));hide(a);}else return;this.fadeTo(b,a);this.current=a;if(this.directory[b].isIframe)DOM.remove(b);Arbiter.inform(GiftsMall.SWITCHED_TO,{sender:this,prev:b,id:a},Arbiter.BEHAVIOR_STATE);return true;},fadeTo:function(a,b){show(b);hide(a);},getCrumbs:function(b){b=b||this.current;var a=[];while(b){a.push({title:this.directory[b].title,onclick:(b!=this.current)&&this.switchTo.curry(b).bind(this)});b=this.directory[b].parent;}return a.reverse();},isIframe:function(a){return this.directory[a].isIframe;}};GiftsMall.SWITCH_TO='GiftsMall.SWITCH_TO';GiftsMall.SWITCHED_TO='GiftsMall.SWITCHED_TO';GiftsMall.SET_PURCHASE_BUTTON='GiftsMall.SET_PURCHASE_BUTTON';function Breadcrumb(a){this.root=a;CSS.addClass(this.root,'gifts_mall_breadcrumb');Arbiter.subscribe(GiftsMall.SWITCHED_TO,function(c,b){this.update(b.sender.getCrumbs());}.bind(this));}Breadcrumb.prototype={update:function(c){if(!c.length)return;DOM.setContent(this.root,'');for(var d=0;d<c.length;++d){var b=c[d];var a=d?'not_first':'first';DOM.appendContent(this.root,$N(b.onclick?'a':'span',{className:a,onclick:b.onclick||bagofholding},htmlize(b.title)));}}};function GiftsMallFullPage(){this.submitButton=$('giftshop_continue_button');new Breadcrumb($('gifts_full_page_breadcrumb'));Arbiter.subscribe(GiftsMall.SWITCHED_TO,function(b,a){GiftshopController.forcePublicPrivacy(a.sender.isIframe(a.id));});Event.listen(this.submitButton,'click',function(){if(!CSS.hasClass(this.submitButton,'uiButtonDisabled'))GiftshopController.onclickSubmit();return false;}.bind(this));Arbiter.subscribe(GiftsMall.SET_PURCHASE_BUTTON,function(b,a){if(a.enable!=undefined)CSS.conditionClass(this.submitButton,'uiButtonDisabled',!a.enable);if(a.buttonText!=undefined)DOM.setContent(DOM.find(this.submitButton,'.uiButtonText'),a.buttonText);}.bind(this));}copy_properties(GiftsMallFullPage.prototype,{onSubmit:function(){var c=Form.serialize(this.form);var b=$(this.form.message);c.message=Input.getValue(b);var d=c.receiver;delete c.receiver;var a=URI.getRequestURI().removeQueryData(['ref']).toString();GiftshopController.initOrder(d,c,a);}});
function GiftshopController(){}GiftshopController.giftsAppId=2386512837;GiftshopController.giftsApiKey='baf530df1c0ee03c86f5f55b2e6ca3e1';GiftshopController.maxMessageLength=1000;GiftshopController.selectBrowseTag=function(b){if(ge('giftshop_search_option_input'))DOM.scry($('giftshop_search_option_input'),'a.token').each(DOM.remove);var a=$('giftshop_tag_options');Form.setSelectValue(a,b);a.onchange();};GiftshopController.initialize=function(d,c,a,b,e){GiftshopController.cachedPages={};GiftshopController.currentSettings={};GiftshopController.setCurrentSettings(a);GiftshopController.setCachedPage(d,c,b);GiftshopController.user=e;GiftshopController.forcePublicPrivacy(false);GiftshopController.numSkusPerPage=c;};GiftshopController.buildHashkeyCachedPages=function(d,c){var a=JSON.stringify(GiftshopController.getCurrentSettings());var b=[d,c,a].join(':');return b;};GiftshopController.setCachedPage=function(d,c,b){var a=GiftshopController.buildHashkeyCachedPages(d,c);GiftshopController.cachedPages[a]=b;GiftshopController.lastPage=a;};GiftshopController.getCachedPage=function(c,b){var a=GiftshopController.buildHashkeyCachedPages(c,b);return GiftshopController.cachedPages[a]||null;};GiftshopController.getCurrentSettings=function(){return GiftshopController.currentSettings;};GiftshopController.getCurrentSettingByKey=function(a){return GiftshopController.currentSettings[a]||null;};GiftshopController.setCurrentSettings=function(a){GiftshopController.currentSettings=a;};GiftshopController.setCurrentSettingByKey=function(a,b){GiftshopController.currentSettings[a]=b;};GiftshopController.assignComposerButtonState=function(){var c=false;var e=false;var g=true;if(GiftshopController.getAutoExpandedMode()&&!GiftshopController.getHasInteracted()){g=false;c=true;}var d=GiftStoreManager.getInstance();if(d){var b=d.getAppOrderInfo();var a=b.api_key;var f=b.order_info;if(f.sku||f.price){c=true;e=((a==GiftshopController.giftsApiKey)&&!GiftshopController.getSkuPrice(f.sku));}}GiftshopController.enablePurchaseButton(c);if(g)GiftshopController.updateComposerButtonText(e);};GiftshopController.updateComposerButtonText=function(a){Arbiter.inform(GiftsMall.SET_PURCHASE_BUTTON,{buttonText:a?_tx("Give Gift"):_tx("Buy Gift")});};GiftshopController.enablePurchaseButton=function(a){Arbiter.inform(GiftsMall.SET_PURCHASE_BUTTON,{enable:a});};GiftshopController.set_item_category=function(e){if(!e){GiftshopController.log('selected category 0');}else GiftshopController.log('selected category '+e);var b=GiftshopController.getCurrentSettingByKey('tag_id');var a='giftshop_top_tag_'+(b?b:'');var d='giftshop_top_tag_'+(e?e:'');var c='giftshop_top_tag_';};GiftshopController.reset_item_category=GiftshopController.set_item_category.bind(null,null);GiftshopController.search_addtag=function(b,a,c){GiftshopController.findgifts_by_tag(b,a,c.i);};GiftshopController.findgifts_by_tag=function(b,a,c){this.enablePurchaseButton(false);GiftshopController.set_item_category(c);GiftshopController.setCurrentSettingByKey('tag_id',c);GiftStoreManager.getInstance().updatePager();};GiftshopController.search_removetag=function(b,a,c){GiftshopController.reset_item_category();GiftshopController.setCurrentSettingByKey('tag_id',null);GiftStoreManager.getInstance().updatePager();};GiftshopController.skuPrices={};GiftshopController.addSkuPrices=function(a){copy_properties(GiftshopController.skuPrices,a);};GiftshopController.getSkuPrice=function(a){return GiftshopController.skuPrices[a];};GiftshopController.setAutoExpandedMode=function(a){GiftshopController.isAutoExpanded=a;};GiftshopController.getAutoExpandedMode=function(){return GiftshopController.isAutoExpanded;};GiftshopController.setHasInteracted=function(a){GiftshopController.hasInteracted=a;};GiftshopController.getHasInteracted=function(){return GiftshopController.hasInteracted;};GiftshopController.composer=null;GiftshopController.getComposer=function(){return GiftshopController.composer||null;};GiftshopController.fallBackStatusUpdate=function(){var a=GiftshopController.getComposer();if(a)a.reset(true,false,false).post();};GiftshopController.focusMessageInput=function(){var a=GiftshopController.getComposer();if(a){var b=a.focusInput();}else $('message').focus();};GiftshopController.initOrder=function(l,k,d,e,i){i=true;var f;var a;var g=GiftStoreManager.getInstance();if(!g)return;var b=g.getAppOrderInfo();copy_properties(k,b.order_info);a=b.api_key;if(!a){if(GiftshopController.getAutoExpandedMode()){GiftshopController.fallBackStatusUpdate();}else GiftshopController.log('gsh:select-gift '+k.sku);return;}var h=(a==GiftshopController.giftsApiKey)&&!GiftshopController.getSkuPrice(k.sku);if(!l){GiftshopController.log('gsh:select-receiver '+k.sku);f=_tx("Please pick a receiver for your gift.");DOMScroll.scrollTo(new Vector2(0,0,'document'),false);}else if(!k.message&&!i){GiftshopController.log('gsh:include-message '+k.sku);new Dialog().setTitle(_tx("Write Message")).setBody(_tx("Would you like to write a message to send with your gift?")).setButtons([Dialog.newButton('Yes',_tx("Write Message"),null,GiftshopController.focusMessageInput),Dialog.newButton('No',_tx("Send Anyway"),'inputaux',function(){GiftshopController.initOrder(l,k,d,e,true);})]).show();return;}else if(k.message.length>GiftshopController.maxMessageLength){GiftshopController.log('gsh:message-too-long '+k.sku);var j=k.message.length-GiftshopController.maxMessageLength;f=_tx("Your message is too long by {number} characters.",{number:j});}if(f){ErrorDialog.show(_tx("Error"),f);return;}k.source=k.source||'';k.ref=k.ref||URI.getRequestURI().getQueryData().ref||'';if(h){var c=new AsyncRequest('/ajax/giftshop/free_gifts.php').setData({order_info:JSON.stringify(k),receiver:l,back_url:d});if(e)c.setContextData(e,'application_'+a);new Dialog().setAsync(c).show();return;}GiftshopController.enablePurchaseButton(false);GiftCredits.getPrompt(null,l,k,d,GiftshopController.enablePurchaseButton.curry(true),GiftCredits.PLACE_GIFTSHOP,a,e);};GiftshopController.onclickSubmit=function(event){var b=Form.serialize($('giftshop_form'));b.message=Input.getValue($('message'));var c=b.receiver;delete b['receiver'];var a=URI.getRequestURI().removeQueryData(['ref']).toString();GiftshopController.initOrder(c,b,a);event&&event.kill();};GiftshopController.updateNumCredits=function(a,b){if(ge('giftshop_num_credits_balance_holder'))DOM.setContent($('giftshop_num_credits_balance_holder'),a);if(ge('giftshop_num_credits_holder'))DOM.setContent($('giftshop_num_credits_holder'),b);};function gift_recipient_onfound(a){if(!a){$('receiver').value='';$('recipient_pic').style.backgroundImage='';$('recipient_pic').style.height='0px';$('recipient_pic').style.width='0px';}else{$('receiver').value=a.i;$('recipient_pic').style.backgroundImage='url('+a.it+')';$('recipient_pic').style.height='50px';$('recipient_pic').style.width='50px';}return true;}copy_properties(GiftStoreManager,{_instance:null,getAndUpdateInstance:function(c,d,b,e,a){if(!this._instance)this._instance=new GiftStoreManager(c,d,b,e);this._instance.update(e);return this._instance;},getInstance:function(){return this._instance;}});function GiftStoreManager(b,c,a,d){this.embedded_store=$(b);onleaveRegister(bind(this,function(){DOM.remove(this.embedded_store);delete GiftStoreManager._instance;}),true);this.pageOffset=c;this.perPage=a;this.totalPages=d;this.prevSelect=null;this.initialize();this.initPager();this.addGiftListeners();}GiftStoreManager.prototype.updatePager=function(){this.pager.setOffset(0);this.changePage(0);};GiftStoreManager.prototype.initialize=function(b,a,c){this.giftsGrid=DOM.find(this.embedded_store,'div#gifts_grid');this.storeFooter=DOM.find(this.embedded_store,'div#store_footer');};GiftStoreManager.prototype.update=function(a){this.totalPages=a||this.totalPages;this.pager.setTotal(this.totalPages);};GiftStoreManager.prototype.initPager=function(){this.pager=new UIPager(this.totalPages,1,this.pageOffset,this.changePage.bind(this));this.pagerspan=DOM.find(this.embedded_store,'div#giftstore_pager');this.pagerspan.appendChild(this.pager.getRoot());this.pager.setSummaryTextHandler(this.getSummaryText.bind(this));};GiftStoreManager.prototype.getSummaryText=function(a,c,b){return _tx("Page {current} of {total}",{current:a+1,total:c});};GiftStoreManager.prototype.setTotalPages=function(a){GiftStoreManager.getInstance().totalPages=a;GiftStoreManager.getInstance().pager.setTotal(a);};GiftStoreManager.prototype.addGiftListeners=function(){var a=DOM.scry(this.giftsGrid,'div.gift_outer.instock');for(var b=0;b<a.length;b++){Event.listen(a[b],'click',this.giftOnClick.bind(this,a[b]));Event.listen(a[b],'mouseover',this.giftOnMouseOver.bind(this,a[b]));Event.listen(a[b],'mouseout',this.giftOnMouseOut.bind(this,a[b]));}};GiftStoreManager.prototype.changePage=function(b){this.pageOffset=b;if(b<0||b>this.totalPages)return;var a=this.perPage*b;GiftshopController.log('changed to page starting at '+a+' with '+this.perPage+' per page');var d=function(e){this.setTotalPages(e.total_pages);DOM.replace(this.giftsGrid,HTML(e.gifts_grid));this.giftsGrid=DOM.find(this.embedded_store,'div#gifts_grid');this.addGiftListeners();}.bind(this);var c=GiftshopController.getCachedPage(a,this.perPage);if(c){d(c);return;}DOM.empty(this.giftsGrid);CSS.addClass(this.giftsGrid,'gifts_loading');this.paginate(a,this.perPage,d);};GiftStoreManager.prototype.paginate=function(d,c,a){var b={start:d,per_page:c};copy_properties(b,GiftshopController.getCurrentSettings());new AsyncRequest().setURI('/ajax/giftshop/browse.php').setData(b).setHandler(function(f){var e=f.getPayload();if(a)a(e);GiftshopController.setCachedPage(d,c,e);}).send();};GiftStoreManager.prototype.giftOnClick=function(a,event){var b=a.getAttribute('sku');GiftshopController.updateComposerButtonText(GiftshopController.getSkuPrice(b)==0);if(this.prevSelect!=a){GiftshopController.log('selected SKU '+b);if(this.prevSelect)GiftshopController.changeGiftOuterClass(this.prevSelect,'gift_outer');}GiftshopController.changeGiftOuterClass(a,'gift_outer_onclick');this.prevSelect=a;this.setAppOrderInfo(GiftshopController.giftsApiKey,{sku:b},true);event&&event.kill();};GiftStoreManager.prototype.resetSku=function(){if(this.prevSelect)GiftshopController.changeGiftOuterClass(this.prevSelect,'gift_outer');this.prevSelect=null;};GiftStoreManager.prototype.giftOnMouseOver=function(a,event){if(this.prevSelect!=a)GiftshopController.changeGiftOuterClass(a,'gift_outer_onmouseover');event.kill();};GiftshopController.changeGiftOuterClass=function(d,b){var c={gift_outer:0,gift_outer_onmouseover:0,gift_outer_onclick:0};c[b]=1;for(var a in c)if(!c[a]){CSS.removeClass(d,a);}else CSS.addClass(d,a);};GiftStoreManager.prototype.giftOnMouseOut=function(a,event){if(this.prevSelect!=a)GiftshopController.changeGiftOuterClass(a,'gift_outer');event.kill();};GiftStoreManager.prototype.getAppOrderInfo=function(){return {api_key:this.appOrderApiKey||null,order_info:this.appOrderInfo||{}};};GiftStoreManager.prototype.setAppOrderInfo=function(a,b,c){if(!a)return;if(b){this.appOrderApiKey=a;this.appOrderInfo=b;}if(c!==null)GiftshopController.enablePurchaseButton(c);};GiftStoreManager.prototype.clearAppOrderInfo=function(){this.appOrderApiKey=null;this.appOrderInfo={};};GiftshopController.forcePublicPrivacy=function(d){if(ge('delivery_info')&&ge('platform_gift_privacy_txt')){var a=$('delivery_info');var b=$('platform_gift_privacy_txt');if(d){hide(a);show(b);var c=$('gift_privacy_type_0');c.checked=true;}else{show(a);hide(b);}}};GiftshopController.resetForm=function(){$('message').value='';$('gift_privacy_type_0').checked=true;!($('friend_selector').typeahead)&&$('friend_selector').focus();$('friend_selector').typeahead.clear();$('friend_selector').typeahead.blur();gift_recipient_onfound();GiftStoreManager.getInstance().resetSku();};GiftshopController.option_select_tag=function(a,c,b){GiftshopController.findgifts_by_tag(0,b,Form.getSelectValue(a));};GiftshopController.log=function(a){var c='\001';var d=Math.floor((new Date()).getTime()/1000);var b=[d,GiftshopController.user,a].join(c);scribe_log('giftshop',b);};
var FBPay={registerServiceForIFrame:function(){var a={submitOrder:{asyncMethod:FBPay.onSubmitOrderRequest},updateGiftshopOrder:{asyncMethod:FBPay.onUpdateGiftshopOrderRequest},submitGiftshopOrder:{asyncMethod:FBPay.onSubmitGiftshopOrderRequest}};FBPay._rpcServer=new FB.XdComm.XdRpcServer('PaymentsServer',a);},onSubmitOrderRequest:function(d,e,k){var c=d.app_id;var i=d.order_info;var j=d.receiver;var h=d.next_url;var b=d.api_key;var f=d.credits_purchase;var g=null;if(d.dev_purchase_params&&d.dev_purchase_params.shortcut=='offer'&&d.dev_purchase_params.offer_type=='dealspot'){g=d.dev_purchase_params;}else g={oscif:d.oscif,shortcut:d.shortcut,deal_id:d.deal_id,product_id:d.product_id,geo:d.geo};var a={logging_data:{purchase_type:d.purchase_type}};GiftCredits.getPrompt(c,j,i,h,e,null,b,null,f,g,a);},onUpdateGiftshopOrderRequest:function(a,b,f){var c=a.order_info||null;var d=null;a.price!==undefined&&(d=a.price);var e=null;a.ready!==undefined&&(e=a.ready);GiftStoreManager.getInstance().setAppOrderInfo(a.api_key,c,e);},onSubmitGiftshopOrderRequest:function(){var a=GiftshopController.getComposer();if(a){a.getData();}else GiftshopController.onclickSubmit();}};
var details_shown=false;function toggle_stored_cc(a){if(a.checked==true){show('cvv2_div');hide_new_cc();}else{hide('cvv2_div');show_new_cc();}}function hide_cc_payment(){hide('card_payment');hide('cvv2_div');hide_new_cc();var a=ge('cc_id');if(a)a.checked=false;}function show_cc_payment(){show('card_payment');}function hide_new_cc(){hide('cc_input');hide('enter_new_card');}function show_new_cc(){show('cc_input');show('enter_new_card');if(details_shown)toggleStoredCreditCardDetails();}function toggleStoredCreditCardDetails(){var a=ge('toggle_stored_credit_card_details_link');if(!details_shown){show('stored_credit_card_details');a.innerHTML=_tx("hide details");details_shown=true;}else{hide('stored_credit_card_details');a.innerHTML=_tx("show details");details_shown=false;}}function show_csc_info(b){var c=_tx("A Card Security Code (CSC) is a security feature of debit and credit cards that helps fight credit card fraud.  The following graphic illustrates where to find the CSC code on your credit card.");var d='float: left;';var g='text-align: center; margin: 5px 0;';var a='';a+='<div style="'+d+'">';a+='<img src="/images/cvv2_types/amex_csc.gif" alt="" />';a+='<p style="'+g+'">'+_tx("American Express")+'</p>';a+='</div>';var f='';f+='<div style="margin-right: 8px;'+d+'">';f+='<img src="/images/cvv2_types/backofcard.gif" alt="" />';f+='<p style="'+g+'">'+_tx("Visa, Mastercard, JCB")+'</p>';f+='</div>';var e='';e+='<div class="clearfix">';e+='<p>'+c+'</p>';if(b==null){e+=f;e+=a;}else if(b==65){e+=a;}else e+=f;e+='</div>';new Dialog().setClassName('csc_type').setTitle(_tx("What's a CSC?")).setBody(e).setButtons([Dialog.OK]).show();}function show_csc_validation_info(){var a='';a+='<div class="clearfix">';a+='<div style="float: left">';a+='<p style="text-align: left; margin: 5px 0;">';a+=_tx("In order to fight credit card fraud, we have started to enforce CSC code validation in credit card payments.  For credit cards we have stored before, this means they will need to be CSC validated once for later uses.  You will not be prompted in the future once the card gets validated.");a+='</p>';a+='</div>';a+='</div>';new Dialog().setClassName('validation').setTitle(_tx("Why is CSC validation required?")).setBody(a).setButtons([Dialog.OK]).show();}function get_selected_cc_type(a,b){if(b){cc_type=Form.getSelectValue(get_dialog_pro_elem(a));}else cc_type=Form.getSelectValue(ge(a));return cc_type;}function validate_csc(a,d){if(d){var c=get_dialog_pro_elem('cc_cvv2');}else var c=ge('cc_cvv2');var b=get_selected_cc_type(a,d);if(b==65){if(c.value.length!=4){c.style.border="1px solid red;";}else c.style.border="";}else if(c.value.length!=3){c.style.border="1px solid red;";}else c.style.border="";}function get_dialog_pro_elem(c){var b=document.getElementsByName(c);var d;var e=null;for(d=0;d<b.length;d++){var a=b[d];if(DOM.contains('pop_content',a))e=a;}return e;}